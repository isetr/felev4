(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK;a=window;b=a.WebSharper=a.WebSharper||{};c=b.UI=b.UI||{};d=c.Next=c.Next||{};e=d.Array=d.Array||{};f=d.String=d.String||{};g=d.Abbrev=d.Abbrev||{};h=g.Fresh=g.Fresh||{};i=g.HashSet=g.HashSet||{};j=g.Dict=g.Dict||{};k=g.Slot=g.Slot||{};l=g.Async=g.Async||{};m=g.Mailbox=g.Mailbox||{};n=a.StartupCode$WebSharper_UI_Next$Abbrev=a.StartupCode$WebSharper_UI_Next$Abbrev||{};o=d.AppendList=d.AppendList||{};p=a.StartupCode$WebSharper_UI_Next$AppendList=a.StartupCode$WebSharper_UI_Next$AppendList||{};q=d.DomUtility=d.DomUtility||{};r=q.InsertPos=q.InsertPos||{};s=a.StartupCode$WebSharper_UI_Next$DomUtility=a.StartupCode$WebSharper_UI_Next$DomUtility||{};t=d.Trie=d.Trie||{};u=t.LookupResult=t.LookupResult||{};v=a.StartupCode$WebSharper_UI_Next$Trie=a.StartupCode$WebSharper_UI_Next$Trie||{};w=d.Snap=d.Snap||{};x=d.View=d.View||{};y=d.Var=d.Var||{};z=d.Submitter=d.Submitter||{};A=d.Key=d.Key||{};B=d.Model=d.Model||{};C=d.Serializer=d.Serializer||{};D=d.Storage=d.Storage||{};E=D.ArrayStorage=D.ArrayStorage||{};F=D.LocalStorageBackend=D.LocalStorageBackend||{};G=d.ListModel=d.ListModel||{};H=d.ListModels=d.ListModels||{};I=a.StartupCode$WebSharper_UI_Next$Models=a.StartupCode$WebSharper_UI_Next$Models||{};J=d.ReactiveExtensions=d.ReactiveExtensions||{};K=d.DoubleInterpolation=d.DoubleInterpolation||{};L=d.Interpolation=d.Interpolation||{};M=d.Easing=d.Easing||{};N=d.Easings=d.Easings||{};O=d.An=d.An||{};P=d.Anims=d.Anims||{};Q=d.Trans=d.Trans||{};R=a.StartupCode$WebSharper_UI_Next$Animation=a.StartupCode$WebSharper_UI_Next$Animation||{};S=d.AnimatedAttrNode=d.AnimatedAttrNode||{};T=d.DynamicAttrNode=d.DynamicAttrNode||{};U=d.AttrProxy=d.AttrProxy||{};V=d.Client=d.Client||{};W=V.Attrs=V.Attrs||{};X=W.Dyn=W.Dyn||{};Y=d.Attrs=d.Attrs||{};Z=d.CheckedInput=d.CheckedInput||{};_0=d.AttrModule=d.AttrModule||{};_1=a.StartupCode$WebSharper_UI_Next$Attr_Client=a.StartupCode$WebSharper_UI_Next$Attr_Client||{};_2=V.DocNode=V.DocNode||{};_3=d.DocElemNode=d.DocElemNode||{};_4=V.Docs=V.Docs||{};_5=_4.DomNodes=_4.DomNodes||{};_6=_4.NodeSet=_4.NodeSet||{};_7=_4.RunState=_4.RunState||{};_8=d.Docs=d.Docs||{};_9=d.Doc=d.Doc||{};_=d.Elt=d.Elt||{};$=a.StartupCode$WebSharper_UI_Next$Doc_Client=a.StartupCode$WebSharper_UI_Next$Doc_Client||{};ba=d.Flow=d.Flow||{};bb=d.FlowBuilder=d.FlowBuilder||{};bc=d.Html=d.Html||{};bd=bc.attr=bc.attr||{};be=d.Route=d.Route||{};bf=be.T=be.T||{};bg=d.Routing=d.Routing||{};bh=bg.State=bg.State||{};bi=d.RouteMap=d.RouteMap||{};bj=d.Router=d.Router||{};bk=d.Input=d.Input||{};bl=bk.MousePosSt=bk.MousePosSt||{};bm=bk.MouseBtnSt=bk.MouseBtnSt||{};bn=bk.Mouse=bk.Mouse||{};bo=bk.KeyListenerSt=bk.KeyListenerSt||{};bp=bk.Keyboard=bk.Keyboard||{};bq=a.StartupCode$WebSharper_UI_Next$Input=a.StartupCode$WebSharper_UI_Next$Input||{};br=b&&b.List;bs=b&&b.Arrays;bt=b&&b.Enumerator;bu=b&&b.Strings;bv=b&&b.Char;bw=b&&b.Collections;bx=bw&&bw.HashSet;by=b&&b.Seq;bz=a.IntelliFactory;bA=bz&&bz.Runtime;bB=b&&b.Unchecked;bC=b&&b.Concurrency;bD=bw&&bw.Map;bE=bw&&bw.FSharpMap;bF=bw&&bw.List;bG=b&&b.Operators;bH=b&&b.Ref;bI=b&&b.Lazy;bJ=bw&&bw.Dictionary;bK=b&&b.Slice;e.mapInPlace=function(bL,bM){var bN,bO;for(bN=0,bO=bM.length-1;bN<=bO;bN++)bM[bN]=bL(bM[bN]);return bM;};e.ofSeqNonCopying=function(bL){var bM,bN,bO;if(bL instanceof a.Array)return bL;else if(bL instanceof br.T)return bs.ofList(bL);else if(bL===null)return[];else{bM=[];bN=bt.Get(bL);try{while(bN.MoveNext()){bO=bM.push(bN.Current());}return bM;}finally{if("Dispose"in bN)bN.Dispose();}}};e.MapTreeReduce=function(bL,bM,bN,bO){var bP;function bQ(bR,bS){var bT,bU;return bS<=0?bM:(bS===1?(bR>=0?bR<bP:false)?true:false:false)?bL(bs.get(bO,bR)):(bU=bS/2>>0,bN(bQ(bR,bU),bQ(bR+bU,bS-bU)));}bP=bs.length(bO);return bQ(0,bP);};e.TreeReduce=function(bL,bM,bN){var bO;function bP(bQ,bR){var bS,bT;return bR<=0?bL:(bR===1?(bQ>=0?bQ<bO:false)?true:false:false)?bs.get(bN,bQ):(bT=bR/2>>0,bM(bP(bQ,bT),bP(bQ+bT,bR-bT)));}bO=bs.length(bN);return bP(0,bO);};f.isBlank=function(bL){return bu.forall(bv.IsWhiteSpace,bL);};h.Id=function(){h.set_counter(h.counter()+1);return"uid"+a.String(h.counter());};h.Int=function(){h.set_counter(h.counter()+1);return h.counter();};h.counter=function(){n.$cctor();return n.counter;};h.set_counter=function(bL){n.$cctor();n.counter=bL;};i.Filter=function(bL,bM){var bN;return new bx.New$2((bN=i.ToArray(bM),bs.filter(bL,bN)));};i.Intersect=function(bL,bM){var bN;bN=new bx.New$2(i.ToArray(bL));bN.IntersectWith(i.ToArray(bM));return bN;};i.Except=function(bL,bM){var bN;bN=new bx.New$2(i.ToArray(bM));bN.ExceptWith(i.ToArray(bL));return bN;};i.ToArray=function(bL){var bM;bM=bs.create(bL.get_Count(),void 0);bL.CopyTo(bM);return bM;};j.ToValueArray=function(bL){var bM,bN;bM=bs.create(bL.count,void 0);bN=function(bO,bP){return bs.set(bM,bO,bP.V);};(function(bO){by.iteri(bN,bO);}(bL));return bM;};j.ToKeyArray=function(bL){var bM,bN;bM=bs.create(bL.count,void 0);bN=function(bO,bP){return bs.set(bM,bO,bP.K);};(function(bO){by.iteri(bN,bO);}(bL));return bM;};k=g.Slot=bA.Class({GetHashCode:function(){return bB.Hash(this.key(this.value));},Equals:function(bL){return bB.Equals(this.key(this.value),this.key(bL.get_Value()));},get_Value:function(){return this.value;}},null,k);k.New=bA.Ctor(function(bL,bM){this.key=bL;this.value=bM;null;},k);k.Create=function(bL,bM){return new k.New(bL,bM);};l.OnError=function(bL){return a.console.log("WebSharper UI.Next: Uncaught asynchronous exception",bL);};l.Schedule=function(bL){var bM;bM=bC.Delay(function(){bL();return bC.Return(null);});bC.Start(bM,null);};l.StartTo=function(bL,bM){bC.StartWithContinuations(bL,bM,function(bN){l.OnError(bN);},function(bN){},null);};m.StartProcessor=function(bL){var bM;function bN(){return bC.Delay(function(){return bC.Bind(bL,function(){var bO,bP;bO=bM[0];return bB.Equals(bO,1)?(bM[0]=0,bC.Return(null)):bB.Equals(bO,2)?(bM[0]=1,(bP=bN(),bC.Bind(bP,function(){return bC.Return(null);}))):bC.Return(null);});});}bM=[0];return function(){var bO,bP;bO=bM[0];bB.Equals(bO,0)?(bM[0]=1,(bP=bN(),bC.Start(bP,null))):bB.Equals(bO,1)?void(bM[0]=2):null;};};n.$cctor=bA.Cctor(function(){n.counter=0;n.$cctor=a.ignore;});o.FromArray=function(bL){var bM;bM=bL.length;return bM===0?{$:0}:bM===1?{$:1,$0:bs.get(bL,0)}:{$:3,$0:bL.slice()};};o.ToArray=function(bL){var bM;function bN(bO){if(bO.$==1)bM.push(bO.$0);else if(bO.$==2){bN(bO.$0);bN(bO.$1);}else if(bO.$==3)bs.iter(function(bP){bM.push(bP);},bO.$0);}bM=[];bN(bL);return bM.slice(0);};o.Single=function(bL){return{$:1,$0:bL};};o.Concat=function(bL){var bM,bN;bM=e.ofSeqNonCopying(bL);bN=o.Empty();return e.TreeReduce(bN,o.Append,bM);};o.Append=function(bL,bM){return bL.$==0?bM:bM.$==0?bL:{$:2,$0:bL,$1:bM};};o.Empty=function(){p.$cctor();return p.Empty;};p.$cctor=bA.Cctor(function(){p.Empty={$:0};p.$cctor=a.ignore;});r=q.InsertPos=bA.Class({},null,r);q.SetProperty=function(bL,bM,bN){return bL.setProperty(bM,bN);};q.IterSelector=function(bL,bM,bN){var bO,bP,bQ;bO=bL.querySelectorAll(bM);for(bP=0,bQ=bO.length-1;bP<=bQ;bP++)bN(bO[bP]);};q.ChildrenArray=function(bL){var bM,bN,bO,bP;bM=[];for(bN=0,bO=bL.childNodes.length-1;bN<=bO;bN++){bP=bM.push(bL.childNodes[bN]);}return bM;};q.RemoveClass=function(bL,bM){var bN;bN=a.jQuery(bL).removeClass(bM);};q.AddClass=function(bL,bM){var bN;bN=a.jQuery(bL).addClass(bM);};q.InsertAt=function(bL,bM,bN){var bO,bP,bQ,bR;!(bN.parentNode===bL?(bO=(bP=bN.nextSibling,bB.Equals(bP,null)?new r({$:0}):new r({$:1,$0:bP})),bM.$==1?bO.$==1?bM.$0===bO.$0:false:bO.$==0?true:false):false)?bM.$==1?(bQ=bL.insertBefore(bN,bM.$0),void 0):(bR=bL.appendChild(bN),void 0):null;};q.RemoveNode=function(bL,bM){var bN;if(bM.parentNode===bL){bN=bL.removeChild(bM);}};q.SetStyle=function(bL,bM,bN){q.SetProperty(bL.style,bM,bN);};q.SetAttr=function(bL,bM,bN){bL.setAttribute(bM,bN);};q.RemoveAttr=function(bL,bM){bL.removeAttribute(bM);};q.CreateAttr=function(bL,bM){var bN;bN=q.Doc().createAttribute(bL);bN.value=bM;return bN;};q.CreateText=function(bL){return q.Doc().createTextNode(bL);};q.CreateSvgElement=function(bL){return q.Doc().createElementNS("http://www.w3.org/2000/svg",bL);};q.CreateElement=function(bL){return q.Doc().createElement(bL);};q.Clear=function(bL){var bM;while(bL.hasChildNodes()){bM=bL.removeChild(bL.firstChild);}};q.ClearAttrs=function(bL){var bM;while(bL.hasAttributes()){bM=bL.removeAttributeNode(bL.attributes.item(0));}};q.AppendTo=function(bL,bM){var bN;bN=bL.appendChild(bM);};q.Doc=function(){s.$cctor();return s.Doc;};s.$cctor=bA.Cctor(function(){s.Doc=a.document;s.$cctor=a.ignore;});u=t.LookupResult=bA.Class({},null,u);t.Empty=function(){v.$cctor();return v.Empty;};t.Lookup=function(bL,bM){return t.Look(br.ofSeq(bM),bL);};t.Look=function(bL,bM){var bN,bO;switch(bM.$==2?(bN=bM.$0,0):bM.$==0?bL.$==1?(bN=[bL.$0,bL.$1,bM.$0],1):2:2){case 0:return new u({$:0,$0:bN,$1:bL});break;case 1:bO=bD.TryFind(bN[0],bN[2]);return bO==null?new u({$:1}):t.Look(bN[1],bO.$0);break;case 2:return new u({$:1});break;}};t.ToArray=function(bL){var bM,bN;bM=[];bN=t.Map(bA.Curried2(function(bO,bP){return bM.push(bP);}),bL);return bM.slice(0);};t.Mapi=function(bL,bM){var bN,bO;bN=[0];bO=function(){var bP;bP=bN[0];bN[0]=bP+1;return bP;};return t.Map(function(bP){return bL(bO(),bP);},bM);};t.Map=function(bL,bM){return t.MapLoop(new br.T({$:0}),bL,bM);};t.MapLoop=function(bL,bM,bN){var bO;return bN.$==1?{$:1}:bN.$==2?{$:2,$0:(bM(bL))(bN.$0)}:t.TrieBranch((bO=function(bP,bQ){return t.MapLoop(br.append(bL,br.ofArray([bP])),bM,bQ);},function(bP){return bD.Map(bO,bP);}(bN.$0)));};t.Merge=function(bL){var bM,bN,bO,bP,bQ;bM=e.ofSeqNonCopying(bL);bN=bs.length(bM);return bN===0?{$:1,$0:{$:1}}:bN===1?{$:1,$0:bs.get(bM,0)}:bs.exists(t.IsLeaf,bM)?null:(bO=(bP=(bQ=function(bR){return bR.$==0?{$:1,$0:bR.$0}:null;},function(bR){return by.choose(bQ,bR);}(bM)),t.MergeMaps(t.Merge,bP)),bO==null?null:{$:1,$0:t.TrieBranch(bO.$0)});};t.IsLeaf=function(bL){return bL.$==2?true:false;};t.MergeMaps=function(bL,bM){var bN,bO,bP,bQ;bN=function(bR){return bD.OfArray(bs.ofSeq(bR));};return function(bR){return bR==null?null:{$:1,$0:bN(bR.$0)};}(t.AllSome((bO=function(bR,bS){var bT;bT=function(bU){return[bR,bU];};return function(bU){return bU==null?null:{$:1,$0:bT(bU.$0)};}(bL(bS));},function(bR){return by.map(function(bS){return bO(bS[0],bS[1]);},bR);}(bD.ToSeq((bP=by.collect(bD.ToSeq,bM),(bQ=new bE.New([]),by.fold(function(bR,bS){return t.MultiAdd(bS[0],bS[1],bR);},bQ,bP))))))));};t.AllSome=function(bL){var bM,bN,bO,bP;bN=bt.Get(bL);bO=new bF.New$2();bM=true;while(bM?bN.MoveNext():false){bP=bN.Current();(bP!=null?bP.$==1:false)?bO.Add(bP.$0):void(bM=false);}return bM?{$:1,$0:bO.ToArray()}:null;};t.MultiAdd=function(bL,bM,bN){return bN.Add(bL,new br.T({$:1,$0:bM,$1:t.MultiFind(bL,bN)}));};t.MultiFind=function(bL,bM){return bG.DefaultArg(bD.TryFind(bL,bM),new br.T({$:0}));};t.Prefix=function(bL,bM){return t.TrieBranch(new bE.New(br.ofArray([[bL,bM]])));};t.Leaf=function(bL){return{$:2,$0:bL};};t.TrieBranch=function(bL){return bL.get_IsEmpty()?{$:1}:{$:0,$0:bL};};v.$cctor=bA.Cctor(function(){v.Empty={$:1};v.$cctor=a.ignore;});w.MapAsync=function(bL,bM){var bN;bN=w.Create();w.When(bM,function(bO){l.StartTo(bL(bO),function(bP){w.MarkDone(bN,bM,bP);});},w.Obs(bN));return bN;};w.SnapshotOn=function(bL,bM){var bN,bO;function bP(bQ){var bR,bS,bT;if(!w.IsDone(bN)){bR=w.ValueAndForever(bL);bS=w.ValueAndForever(bM);(bR!=null?bR.$==1:false)?(bS!=null?bS.$==1:false)?(bT=bS.$0[0],(bR.$0[1]?true:bS.$0[1])?w.MarkForever(bN,bT):w.MarkReady(bN,bT)):null:null;}}bN=w.Create();bO=w.Obs(bN);w.When(bL,bP,bO);w.When(bM,bP,function(){});return bN;};w.Map3=function(bL,bM,bN,bO){var bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2;function b3(b4){var b5,b6,b7,b8,b9,b_;if(!w.IsDone(b1)){b5=w.ValueAndForever(bM);b6=w.ValueAndForever(bN);b7=w.ValueAndForever(bO);(b5!=null?b5.$==1:false)?(b6!=null?b6.$==1:false)?(b7!=null?b7.$==1:false)?(b8=b5.$0[0],(b9=b6.$0[0],(b_=b7.$0[0],((b5.$0[1]?b6.$0[1]:false)?b7.$0[1]:false)?w.MarkForever(b1,bL(b8,b9,b_)):w.MarkReady(b1,bL(b8,b9,b_))))):null:null:null;}}bP=bM.s;bQ=bN.s;bR=bO.s;return bP.$==0?bQ.$==0?bR.$==0?w.CreateForever(bL(bP.$0,bQ.$0,bR.$0)):(bS=bP.$0,(bT=bQ.$0,w.Map(function(b4){return bL(bS,bT,b4);},bO))):bR.$==0?(bU=bP.$0,(bV=bR.$0,w.Map(function(b4){return bL(bU,b4,bV);},bN))):(bW=bP.$0,w.Map2(function(b4,b5){return bL(bW,b4,b5);},bN,bO)):bQ.$==0?bR.$==0?(bX=bQ.$0,(bY=bR.$0,w.Map(function(b4){return bL(b4,bX,bY);},bM))):(bZ=bQ.$0,w.Map2(function(b4,b5){return bL(b4,bZ,b5);},bM,bO)):bR.$==0?(b0=bR.$0,w.Map2(function(b4,b5){return bL(b4,b5,b0);},bM,bN)):(b1=w.Create(),(b2=w.Obs(b1),(w.When(bM,b3,b2),w.When(bN,b3,b2),w.When(bO,b3,b2),b1)));};w.Map2Unit=function(bL,bM){var bN,bO,bP;function bQ(){var bR,bS;if(!w.IsDone(bO)){bR=w.ValueAndForever(bL);bS=w.ValueAndForever(bM);(bR!=null?bR.$==1:false)?(bS!=null?bS.$==1:false)?(bR.$0[1]?bS.$0[1]:false)?w.MarkForever(bO,null):w.MarkReady(bO,null):null:null;}}bN=bM.s;return bL.s.$==0?bN.$==0?w.CreateForever():bM:bN.$==0?bL:(bO=w.Create(),(bP=w.Obs(bO),(w.When(bL,bQ,bP),w.When(bM,bQ,bP),bO)));};w.Map2=function(bL,bM,bN){var bO,bP,bQ,bR,bS,bT;function bU(bV){var bW,bX,bY,bZ;if(!w.IsDone(bS)){bW=w.ValueAndForever(bM);bX=w.ValueAndForever(bN);(bW!=null?bW.$==1:false)?(bX!=null?bX.$==1:false)?(bY=bW.$0[0],(bZ=bX.$0[0],(bW.$0[1]?bX.$0[1]:false)?w.MarkForever(bS,bL(bY,bZ)):w.MarkReady(bS,bL(bY,bZ)))):null:null;}}bO=bM.s;bP=bN.s;return bO.$==0?bP.$==0?w.CreateForever(bL(bO.$0,bP.$0)):(bQ=bO.$0,w.Map(function(bV){return bL(bQ,bV);},bN)):bP.$==0?(bR=bP.$0,w.Map(function(bV){return bL(bV,bR);},bM)):(bS=w.Create(),(bT=w.Obs(bS),(w.When(bM,bU,bT),w.When(bN,bU,bT),bS)));};w.MapCachedBy=function(bL,bM,bN,bO){return w.Map(function(bP){var bQ,bR,bS;bQ=bM[0];return((bQ!=null?bQ.$==1:false)?bL(bP,bQ.$0[0])?(bR=[bQ.$0[0],bQ.$0[1]],true):false:false)?bR[1]:(bS=bN(bP),(bM[0]={$:1,$0:[bP,bS]},bS));},bO);};w.Map=function(bL,bM){var bN,bO,bP;bN=bM.s;return bN.$==0?w.CreateForever(bL(bN.$0)):(bO=w.Create(),(w.When(bM,(bP=function(bQ){w.MarkDone(bO,bM,bQ);},function(bQ){return bP(bL(bQ));}),w.Obs(bO)),bO));};w.Sequence=function(bL){var bM,bN,bO,bP,bQ,bR;bM=bs.ofSeq(bL);return bM.length==0?w.CreateForever([]):(bN=w.Create(),(bO=[bs.length(bM)-1],(bP=w.Obs(bN),(bQ=function(){var bS,bT;if(bO[0]===0){bS=(bT=function(bU){var bV;bV=bU.s;return bV.$==0?bV.$0:bV.$==2?bV.$0:bG.FailWith("value not found by View.Sequence");},function(bU){return bs.map(bT,bU);}(bM));bs.forall(w.IsForever,bM)?w.MarkForever(bN,bS):w.MarkReady(bN,bS);}else bH.decr(bO);},(bR=function(bS){w.When(bS,bQ,bP);},function(bS){bs.iter(bR,bS);}(bM),bN)))));};w.CreateForeverAsync=function(bL){var bM;bM=w.Make({$:3,$0:[],$1:[]});l.StartTo(bL,function(bN){w.MarkForever(bM,bN);});return bM;};w.JoinInner=function(bL){var bM,bN;bM=w.Create();bN=w.Obs(bM);w.When(bL,function(bO){var bP;bP=bO();w.When(bP,function(bQ){if(w.IsForever(bP)?w.IsForever(bL):false)w.MarkForever(bM,bQ);else w.MarkReady(bM,bQ);},bN);w.WhenObsolete(bL,w.Obs(bP));},bN);return bM;};w.Join=function(bL){var bM,bN;bM=w.Create();bN=w.Obs(bM);w.When(bL,function(bO){var bP;bP=bO();w.When(bP,function(bQ){if(w.IsForever(bP)?w.IsForever(bL):false)w.MarkForever(bM,bQ);else w.MarkReady(bM,bQ);},bN);},bN);return bM;};w.ValueAndForever=function(bL){var bM;bM=bL.s;return bM.$==0?{$:1,$0:[bM.$0,true]}:bM.$==2?{$:1,$0:[bM.$0,false]}:null;};w.WhenObsolete=function(bL,bM){var bN;bN=bL.s;bN.$==1?bM():bN.$==2?bN.$1.push(bM):bN.$==3?bN.$1.push(bM):null;};w.When=function(bL,bM,bN){var bO;bO=bL.s;bO.$==1?bN():bO.$==2?(bO.$1.push(bN),bM(bO.$0)):bO.$==3?(bO.$0.push(bM),bO.$1.push(bN)):bM(bO.$0);};w.MarkDone=function(bL,bM,bN){if(w.IsForever(bM))w.MarkForever(bL,bN);else w.MarkReady(bL,bN);};w.MarkReady=function(bL,bM){var bN;bN=bL.s;bN.$==3?(bL.s={$:2,$0:bM,$1:bN.$1},by.iter(function(bO){bO(bM);},bN.$0)):null;};w.Obs=function(bL){return function(){w.MarkObsolete(bL);};};w.MarkObsolete=function(bL){var bM,bN;bM=bL.s;(bM.$==1?true:bM.$==2?(bN=bM.$1,false):bM.$==3?(bN=bM.$1,false):true)?null:(bL.s={$:1},by.iter(function(bO){bO();},bN));};w.MarkForever=function(bL,bM){var bN;bN=bL.s;bN.$==3?(bL.s={$:0,$0:bM},by.iter(function(bO){bO(bM);},bN.$0)):null;};w.IsDone=function(bL){var bM;bM=bL.s;return bM.$==0?true:bM.$==2?true:false;};w.IsObsolete=function(bL){return bL.s.$==1?true:false;};w.IsForever=function(bL){return bL.s.$==0?true:false;};w.CreateWithValue=function(bL){return w.Make({$:2,$0:bL,$1:[]});};w.CreateForever=function(bL){return w.Make({$:0,$0:bL});};w.Create=function(){return w.Make({$:3,$0:[],$1:[]});};w.Make=function(bL){return{s:bL};};x=d.View=bA.Class({},null,x);y=d.Var=bA.Class({RId:function(){return"uinref"+a.String(this.i);},RView:function(){return this.v;},RUpdM:function(bL){var bM;bM=bL(this.c);(bM!=null?bM.$==1:false)?y.Set(this,bM.$0):null;},RUpd:function(bL){y.Update(this,bL);},set_RVal:function(bL){y.Set(this,bL);},RVal:function(){return this.c;},RSet:function(bL){y.Set(this,bL);},RGet:function(){return this.c;}},null,y);y.New=function(bL,bM,bN,bO,bP){return new y({o:bL,c:bM,s:bN,i:bO,v:bP});};y.Lens=function(bL,bM,bN){var bO,bP,bQ;bO=h.Id();bP=(bQ=bL.RView(),x.Map(bM,bQ));return{RId:function(){return bO;},RView:function(){return bP;},RUpdM:function(bR){return bL.RUpdM(function(bS){var bT;bT=bR(bM(bS));return bT==null?null:{$:1,$0:bN(bS,bT.$0)};});},RUpd:function(bR){return bL.RUpd(function(bS){return bN(bS,bR(bM(bS)));});},set_RVal:function(bR){return bL.RUpd(function(bS){return bN(bS,bR);});},RVal:function(){return bM(bL.RGet());},RSet:function(bR){return bL.RUpd(function(bS){return bN(bS,bR);});},RGet:function(){return bM(bL.RGet());}};};y.Update=function(bL,bM){var bN;bN=bM(bL.c);y.Set(bL,bN);};y.SetFinal=function(bL,bM){if(bL.o)(function(bN){return bN("WebSharper UI.Next: invalid attempt to change value of a Var after calling SetFinal");}(function(bN){a.console.log(bN);}));else{w.MarkObsolete(bL.s);bL.o=true;bL.c=bM;bL.s=w.CreateForever(bM);}};y.Set=function(bL,bM){if(bL.o)(function(bN){return bN("WebSharper UI.Next: invalid attempt to change value of a Var after calling SetFinal");}(function(bN){a.console.log(bN);}));else{w.MarkObsolete(bL.s);bL.c=bM;bL.s=w.CreateWithValue(bM);}};y.Create=function(){var bL;bL=null;bL=y.New(false,null,w.CreateWithValue(),h.Int(),function(){return bL.s;});return bL;};y.Create$1=function(bL){var bM;bM=null;bM=y.New(false,bL,w.CreateWithValue(bL),h.Int(),function(){return bM.s;});return bM;};x.get_Do=function(){return{$:0};};x.Apply=function(bL,bM){return x.Map2(function(bN,bO){return bN(bO);},bL,bM);};x.AsyncAwait=function(bL,bM){var bN;bN=function(bO){var bP,bQ;function bR(){return x.RemovableSink(function(bS){if(bL(bS)){(bI.Force(bP))();bO(bS);}},bM);}bP=bI.Create(bR);bQ=bI.Force(bP);};return bC.FromContinuations(function(bO,bP,bQ){return bN.apply(null,[bO,bP,bQ]);});};x.RemovableSink=function(bL,bM){var bN;function bO(){var bP;bP=bM();w.When(bP,function(bQ){if(bN[0])bL(bQ);},function(){if(bN[0])l.Schedule(bO);});}bN=[true];l.Schedule(bO);return function(){bN[0]=false;};};x.Sink=function(bL,bM){function bN(){var bO;bO=bM();w.When(bO,bL,function(){l.Schedule(bN);});}l.Schedule(bN);};x.TryFinally=function(bL,bM){return x.CreateLazy(function(){try{return bM();}finally{bL();}});};x.TryWith=function(bL,bM){return x.CreateLazy(function(){try{return bM();}catch(bN){return(bL(bN))();}});};x.ConstAsync=function(bL){var bM;bM=w.CreateForeverAsync(bL);return function(){return bM;};};x.Const=function(bL){var bM;bM=w.CreateForever(bL);return function(){return bM;};};x.Sequence=function(bL){return x.CreateLazy(function(){var bM;return w.Sequence((bM=function(bN){return bN();},function(bN){return by.map(bM,bN);}(bL)));});};x.UpdateWhile=function(bL,bM,bN){var bO;bO=[bL];return x.BindInner(function(bP){return bP?x.Map(function(bQ){bO[0]=bQ;return bQ;},bN):x.Const(bO[0]);},bM);};x.BindInner=function(bL,bM){return x.JoinInner(x.Map(bL,bM));};x.JoinInner=function(bL){return x.CreateLazy(function(){return w.JoinInner(bL());});};x.Bind=function(bL,bM){return x.Join(x.Map(bL,bM));};x.Join=function(bL){return x.CreateLazy(function(){return w.Join(bL());});};x.MapSeqCachedView=function(bL,bM){var bN;bN=function(){return bL;};return x.MapSeqCachedViewBy(a.id,function(bO,bP){return(bN(bO))(bP);},bM);};x.MapSeqCachedViewBy=function(bL,bM,bN){var bO,bP;bO=[new bJ.New$5()];bP=function(bQ){var bR,bS,bT,bU;bR=bO[0];bS=new bJ.New$5();bT=(bU=function(bV){var bW,bX,bY;bW=bL(bV);bX=bR.ContainsKey(bW)?(bY=bR.get_Item(bW),(y.Set(bY.r,bV),bY)):x.ConvertSeqNode(function(bZ){return bM(bW,bZ);},bV);bS.set_Item(bW,bX);return bX.e;},function(bV){return e.mapInPlace(bU,bV);}(bs.ofSeq(bQ)));bO[0]=bS;return bT;};return function(bQ){return x.Map(bP,bQ);}(bN);};x.ConvertSeqNode=function(bL,bM){var bN,bO;bN=y.Create$1(bM);bO=bN.v;return{e:bL(bO),r:bN,w:bO};};x.MapSeqCached=function(bL,bM){return x.MapSeqCachedBy(a.id,bL,bM);};x.MapSeqCachedBy=function(bL,bM,bN){var bO,bP;bO=[new bJ.New$5()];bP=function(bQ){var bR,bS,bT,bU;bR=bO[0];bS=new bJ.New$5();bT=(bU=function(bV){var bW,bX;bW=bL(bV);bX=bR.ContainsKey(bW)?bR.get_Item(bW):bM(bV);bS.set_Item(bW,bX);return bX;},function(bV){return e.mapInPlace(bU,bV);}(bs.ofSeq(bQ)));bO[0]=bS;return bT;};return function(bQ){return x.Map(bP,bQ);}(bN);};x.SnapshotOn=function(bL,bM,bN){var bO;bO=w.CreateWithValue(bL);return x.CreateLazy(function(){var bP,bQ;bP=bM();return w.IsObsolete(bO)?(bQ=bN(),w.SnapshotOn(bP,bQ)):(w.WhenObsolete(bP,w.Obs(bO)),bO);});};x.GetAsync=function(bL){return bC.FromContinuations(function(bM){return x.Get(bM,bL);});};x.Get=function(bL,bM){var bN;function bO(){w.When(bM(),function(bP){if(!bN[0]){bN[0]=true;bL(bP);}},function(){if(!bN[0])bO();});}bN=[false];bO();};x.MapAsync2=function(bL,bM,bN){var bO;bO=a.id;return function(bP){return x.MapAsync(bO,bP);}(x.Map2(function(bP,bQ){return(bL(bP))(bQ);},bM,bN));};x.MapAsync=function(bL,bM){return x.CreateLazy(function(){var bN;bN=bM();return w.MapAsync(bL,bN);});};x.Map3=function(bL,bM,bN,bO){return x.CreateLazy(function(){var bP,bQ,bR;bP=bM();bQ=bN();bR=bO();return w.Map3(bL,bP,bQ,bR);});};x.Map2Unit=function(bL,bM){return x.CreateLazy(function(){var bN,bO;bN=bL();bO=bM();return w.Map2Unit(bN,bO);});};x.Map2=function(bL,bM,bN){return x.CreateLazy(function(){var bO,bP;bO=bM();bP=bN();return w.Map2(bL,bO,bP);});};x.MapCached=function(bL,bM){return x.MapCachedBy(bB.Equals,bL,bM);};x.MapCachedBy=function(bL,bM,bN){var bO;bO=[null];return x.CreateLazy(function(){var bP;bP=bN();return w.MapCachedBy(bL,bO,bM,bP);});};x.Map=function(bL,bM){return x.CreateLazy(function(){var bN;bN=bM();return w.Map(bL,bN);});};x.CreateLazy=function(bL){var bM;bM={c:null,o:bL};return function(){var bN;bN=bM.c;return bN===null?(bN=bM.o(),bM.c=bN,w.IsForever(bN)?bM.o=null:w.WhenObsolete(bN,function(){bM.c=null;}),bN):bN;};};z=d.Submitter=bA.Class({Trigger:function(){y.Set(this["var"],null);}},null,z);z.New=bA.Ctor(function(bL,bM){this.input=bL;this["var"]=y.Create();this.view=x.SnapshotOn(bM,this["var"].v,this.input);null;},z);z.CreateOption=function(bL){return new z.New(x.Map(function(bM){return{$:1,$0:bM};},bL),null);};A=d.Key=bA.Class({},null,A);A.Fresh=function(){return new A({$:0,$0:h.Int()});};B=d.Model=bA.Class({},null,B);B.New=bA.Ctor(function(bL,bM){var bN,bO;bN=y.Create$1(bM);bO=x.Map(bL,bN.v);B.New$1.call(this,bN,bO);},B);B.New$1=bA.Ctor(function(bL,bM){this["var"]=bL;this.view=bM;null;},B);B.Update=function(bL,bM){y.Update(bM["var"],function(bN){bL(bN);return bN;});};B.Create=function(bL,bM){return new B.New(bL,bM);};C.Default=function(){I.$cctor();return I.Default;};E=D.ArrayStorage=bA.Class({SSet:function(bL){return bs.ofSeq(bL);},SSetAt:function(bL,bM,bN){bs.set(bN,bL,bM);return bN;},SRemoveIf:function(bL,bM){var bN;return bs.filter((bN=function(bO){return!bO;},function(bO){return bN(bL(bO));}),bM);},SInit:function(){return this.init;},SPrependMany:function(bL,bM){var bN;bN=bM.unshift.apply(bM,e.ofSeqNonCopying(bL));return bM;},SPrepend:function(bL,bM){var bN;bN=bM.unshift(bL);return bM;},SAppendMany:function(bL,bM){var bN;bN=bM.push.apply(bM,e.ofSeqNonCopying(bL));return bM;},SAppend:function(bL,bM){var bN;bN=bM.push(bL);return bM;}},null,E);E.New=bA.Ctor(function(bL){this.init=bL;null;},E);F=D.LocalStorageBackend=bA.Class({clear:function(){this.storage.removeItem(this.id);},set:function(bL){var bM,bN;this.storage.setItem(this.id,(bM=(bN=this.serializer.Encode,function(bO){return bs.map(bN,bO);}(bL)),a.JSON.stringify(bM)));return bL;},SSet:function(bL){return this.set(bs.ofSeq(bL));},SSetAt:function(bL,bM,bN){bs.set(bN,bL,bM);return this.set(bN);},SRemoveIf:function(bL,bM){var bN;return this.set(bs.filter((bN=function(bO){return!bO;},function(bO){return bN(bL(bO));}),bM));},SInit:function(){var bL,bM,bN;bL=this.storage.getItem(this.id);if(bL===null)return[];else try{bM=a.JSON.parse(bL);bN=this.serializer.Decode;return function(bO){return bs.map(bN,bO);}(bM);}catch(bO){return[];}},SPrependMany:function(bL,bM){var bN;bN=bM.unshift.apply(bM,e.ofSeqNonCopying(bL));return this.set(bM);},SPrepend:function(bL,bM){var bN;bN=bM.unshift(bL);return this.set(bM);},SAppendMany:function(bL,bM){var bN;bN=bM.push.apply(bM,e.ofSeqNonCopying(bL));return this.set(bM);},SAppend:function(bL,bM){var bN;bN=bM.push(bL);return this.set(bM);}},null,F);F.New=bA.Ctor(function(bL,bM){this.id=bL;this.serializer=bM;this.storage=a.window.localStorage;null;},F);D.LocalStorage=function(bL,bM){return new F.New(bL,bM);};D.InMemory=function(bL){return new E.New(bL);};G=d.ListModel=bA.Class({Wrap:function(bL,bM,bN){return G.Wrap(this,bL,bM,function(bO,bP){return(bN(bO))(bP);});},Lens:function(bL){var bM;bM=function(bN,bO){return bO;};return this.LensInto(a.id,function(bN,bO){return bM(bN,bO);},bL);},LensInto:function(bL,bM,bN){var bO,bP,bQ,bR;bO=this;bP=h.Id();bQ=(bR=this.FindByKeyAsView(bN),x.Map(bL,bR));return{RId:function(){return bP;},RView:function(){return bQ;},RUpdM:function(bS){return bO.UpdateBy(function(bT){var bU;bU=bS(bL(bT));return bU==null?null:{$:1,$0:bM(bT,bU.$0)};},bN);},RUpd:function(bS){return bO.UpdateBy(function(bT){return{$:1,$0:bM(bT,bS(bL(bT)))};},bN);},set_RVal:function(bS){return this.RSet(bS);},RVal:function(){return this.RGet();},RSet:function(bS){return bO.UpdateBy(function(bT){return{$:1,$0:bM(bT,bS)};},bN);},RGet:function(){return bL(bO.FindByKey(bN));}};},get_LengthAsView:function(){var bL;bL=this["var"].RView();return x.Map(bs.length,bL);},get_Length:function(){return bs.length(this["var"].RVal());},Clear:function(){this["var"].set_RVal(this.storage.SSet([]));this.ObsoleteAll();},UpdateBy:function(bL,bM){var bN,bO,bP,bQ,bR;bN=this;bO=this["var"].RVal();bP=bs.tryFindIndex(function(bS){return bB.Equals(bN.key(bS),bM);},bO);(bP!=null?bP.$==1:false)?(bQ=bP.$0,(bR=bL(bs.get(bO,bQ)),(bR!=null?bR.$==1:false)?(this["var"].set_RVal(this.storage.SSetAt(bQ,bR.$0,bO)),this.ObsoleteKey(bM)):null)):null;},UpdateAll:function(bL){var bM;bM=this;this["var"].RUpd(function(bN){var bO;bO=function(bP,bQ){var bR;bR=function(bS){bs.set(bN,bP,bS);};return function(bS){if(bS==null);else bR(bS.$0);}(bL(bQ));};(function(bP){bs.iteri(bO,bP);}(bN));return bM.storage.SSet(bN);});this.ObsoleteAll();},FindByKeyAsView:function(bL){var bM;bM=function(bN){return bN.$0;};return function(bN){return x.Map(bM,bN);}(this.TryFindByKeyAsView(bL));},TryFindByKeyAsView:function(bL){var bM;bM=this;return function(){var bN,bO,bP,bQ;bN=(bO=null,[bM.it.TryGetValue(bL,{get:function(){return bO;},set:function(bR){bO=bR;}}),bO]);return bN[0]?bN[1]:(bP=bM.TryFindByKey(bL),(bQ=w.CreateWithValue(bP),(bM.it.Add(bL,bQ),bQ)));};},TryFindByKey:function(bL){var bM;bM=this;return bs.tryFind(function(bN){return bB.Equals(bM.key(bN),bL);},this["var"].RVal());},FindByKey:function(bL){var bM;bM=this;return bs.find(function(bN){return bB.Equals(bM.key(bN),bL);},this["var"].RVal());},TryFindAsView:function(bL){var bM;bM=function(bN){return bs.tryFind(bL,bN);};return function(bN){return x.Map(bM,bN);}(this["var"].RView());},FindAsView:function(bL){var bM;bM=function(bN){return bs.find(bL,bN);};return function(bN){return x.Map(bM,bN);}(this["var"].RView());},TryFind:function(bL){return bs.tryFind(bL,this["var"].RVal());},Find:function(bL){return bs.find(bL,this["var"].RVal());},ContainsKeyAsView:function(bL){var bM,bN,bO;bM=this;bN=(bO=function(bP){return bB.Equals(bM.key(bP),bL);},function(bP){return bs.exists(bO,bP);});return function(bP){return x.Map(bN,bP);}(this["var"].RView());},ContainsKey:function(bL){var bM;bM=this;return bs.exists(function(bN){return bB.Equals(bM.key(bN),bL);},this["var"].RVal());},Set:function(bL){this["var"].set_RVal(this.storage.SSet(bL));this.ObsoleteAll();},Iter:function(bL){bs.iter(bL,this["var"].RVal());},RemoveByKey:function(bL){var bM,bN;bM=this;this["var"].set_RVal((bN=this["var"].RVal(),this.storage.SRemoveIf(function(bO){return bB.Equals(bM.key(bO),bL);},bN)));this.ObsoleteKey(bL);},RemoveBy:function(bL){var bM,bN,bO,bP;bM=this["var"].RVal();for(bN=0,bO=bM.length-1;bN<=bO;bN++){bP=bs.get(bM,bN);bL(bP)?this.ObsoleteKey(this.key(bP)):null;}this["var"].set_RVal(this.storage.SRemoveIf(bL,this["var"].RVal()));},Remove:function(bL){var bM,bN,bO,bP;bM=this;bN=this["var"].RVal();H.Contains(bM.key,bL,bN)?(bO=bM.key,(bP=bO(bL),(this["var"].set_RVal(this.storage.SRemoveIf(function(bQ){return bB.Equals(bO(bQ),bP);},bN)),this.ObsoleteKey(bP)))):null;},PrependMany:function(bL){var bM,bN,bO,bP;bM=this;bN=new bF.New$2();this["var"].set_RVal(this.storage.SPrependMany(bN,(bO=this["var"].RVal(),((bP=function(bQ,bR){var bS,bT;bS=bM.key(bR);bM.ObsoleteKey(bS);bT=bs.tryFindIndex(function(bU){return bB.Equals(bM.key(bU),bS);},bQ);return bT==null?(bN.Add(bR),bQ):bM.storage.SSetAt(bT.$0,bR,bQ);},(bA.Curried3(by.fold))(bP))(bO))(bL))));},Prepend:function(bL){var bM,bN,bO,bP;bM=this;bN=this["var"].RVal();bO=this.key(bL);bP=bs.tryFindIndex(function(bQ){return bB.Equals(bM.key(bQ),bO);},bN);(bP!=null?bP.$==1:false)?this["var"].set_RVal(this.storage.SSetAt(bP.$0,bL,bN)):this["var"].set_RVal(this.storage.SPrepend(bL,bN));this.ObsoleteKey(bO);},AppendMany:function(bL){var bM,bN,bO,bP;bM=this;bN=new bF.New$2();this["var"].set_RVal(this.storage.SAppendMany(bN,(bO=this["var"].RVal(),((bP=function(bQ,bR){var bS,bT;bS=bM.key(bR);bM.ObsoleteKey(bS);bT=bs.tryFindIndex(function(bU){return bB.Equals(bM.key(bU),bS);},bQ);return bT==null?(bN.Add(bR),bQ):bM.storage.SSetAt(bT.$0,bR,bQ);},(bA.Curried3(by.fold))(bP))(bO))(bL))));},Append:function(bL){var bM,bN,bO,bP;bM=this;bN=this["var"].RVal();bO=this.key(bL);bP=bs.tryFindIndex(function(bQ){return bB.Equals(bM.key(bQ),bO);},bN);(bP!=null?bP.$==1:false)?this["var"].set_RVal(this.storage.SSetAt(bP.$0,bL,bN)):this["var"].set_RVal(this.storage.SAppend(bL,bN));this.ObsoleteKey(bO);},ObsoleteAll:function(){var bL;bL=function(bM){w.MarkObsolete(bM.V);};(function(bM){by.iter(bL,bM);}(this.it));this.it.Clear();},ObsoleteKey:function(bL){var bM,bN,bO;bM=(bN=null,[this.it.TryGetValue(bL,{get:function(){return bN;},set:function(bP){bN=bP;}}),bN]);bM[0]?(w.MarkObsolete(bM[1]),(bO=this.it.Remove(bL),void 0)):null;},GetEnumerator0:function(){return bt.Get0(this["var"].RVal());},GetEnumerator:function(){return bt.Get(this["var"].RVal());}},null,G);G.New=bA.Ctor(function(bL,bM){var bN;bN=y.Create$1(bs.ofSeq(by.distinctBy(bL,bM.SInit())));G.New$3.call(this,bL,bN,bM);},G);G.New$1=bA.Ctor(function(bL){G.New$2.call(this,bL,[]);},G);G.New$2=bA.Ctor(function(bL,bM){var bN;bN=bs.ofSeq(bM);G.New$3.call(this,bL,y.Create$1(bN),D.InMemory(bN));},G);G.New$3=bA.Ctor(function(bL,bM,bN){var bO;this.key=bL;this["var"]=bM;this.storage=bN;this.v=(bO=this["var"].RView(),x.Map(function(bP){return bP.slice();},bO));this.it=new bJ.New$5();null;},G);H.Contains=function(bL,bM,bN){var bO;bO=bL(bM);return bs.exists(function(bP){return bB.Equals(bL(bP),bO);},bN);};G.Wrap=function(bL,bM,bN,bO){var bP,bQ,bR,bS,bT,bU;bP=[new bJ.New$5()];bQ=(bR=function(bV){var bW;bW=bN(bV);bP[0].set_Item(bL.key(bV),bW);return bW;},function(bV){return bs.map(bR,bV);}(bL["var"].RVal()));bS=(bT=bL["var"],(bU=function(bV){var bW,bX,bY;bW=new bJ.New$5();bX=(bY=function(bZ){var b0,b1;b0=bL.key(bZ);b1=bP[0].ContainsKey(b0)?bO(bP[0].get_Item(b0),bZ):bN(bZ);bW.set_Item(b0,b1);return b1;},function(bZ){return bs.map(bY,bZ);}(bV));bP[0]=bW;return bX;},function(bV){return y.Lens(bT,bU,function(bW,bX){return(bV(bW))(bX);});})(bA.Curried2(function(bV,bW){var bX,bY,bZ;bX=new bJ.New$5();bY=(bZ=function(b0){var b1;b1=bM(b0);bX.set_Item(bL.key(b1),b0);return b1;},function(b0){return bs.map(bZ,b0);}(bW));bP[0]=bX;return bY;})));return new G.New$3(function(bV){var bW;bW=bL.key;return function(bX){return bW(bM(bX));}(bV);},bS,D.InMemory(bQ));};G.FromSeq=function(bL){return G.Create(a.id,bL);};G.Create=function(bL,bM){var bN;bN=D.InMemory(bs.ofSeq(bM));return G.CreateWithStorage(bL,bN);};G.CreateWithStorage=function(bL,bM){return new G.New(bL,bM);};I.$cctor=bA.Cctor(function(){I.Default={Encode:a.id,Decode:a.id};I.$cctor=a.ignore;});J=d.ReactiveExtensions=bA.Class({},null,J);J.New=bA.Ctor(function(){},J);K=d.DoubleInterpolation=bA.Class({Interpolate:function(bL,bM,bN){return bM+bL*(bN-bM);}},null,K);L.get_Double=function(){return new K({$:0});};M=d.Easing=bA.Class({TransformTime:function(bL){return this.transformTime(bL);}},null,M);M.get_CubicInOut=function(){return N.CubicInOut();};M.Custom=function(bL){return new M.New(bL);};M.New=bA.Ctor(function(bL){this.transformTime=bL;null;},M);N.CubicInOut=function(){R.$cctor();return R.CubicInOut;};O=d.An=bA.Class({},null,O);O.get_Empty=function(){return new O({$:0,$0:o.Empty()});};O.WhenDone=function(bL,bM){var bN;bN=new O({$:0,$0:o.Single({$:0,$0:bL})});return function(bO){return O.Append(bN,bO);}(bM);};O.Run=function(bL,bM){var bN,bO;bN=bM.Duration;bO=function(bP){var bQ;function bR(bS,bT){var bU,bV;bU=bT-bS;bM.Compute(bU);bL();return bU<=bN?(bV=a.requestAnimationFrame(function(bW){bR(bS,bW);}),void 0):bP();}bQ=a.requestAnimationFrame(function(bS){bR(bS,bS);});};return bC.FromContinuations(function(bP,bQ,bR){return bO.apply(null,[bP,bQ,bR]);});};O.Play=function(bL){return bC.Delay(function(){var bM,bN;bM=(bN=function(){},function(bO){return O.Run(bN,bO);}(P.Actions(bL)));return bC.Bind(bM,function(){P.Finalize(bL);return bC.Return(null);});});};O.Pack=function(bL){return new O({$:0,$0:o.Single({$:1,$0:bL})});};O.Map=function(bL,bM){var bN;return P.Def(bM.Duration,(bN=bM.Compute,function(bO){return bL(bN(bO));}));};O.Delayed=function(bL,bM,bN,bO,bP,bQ){return{Compute:function(bR){return bR<=bO?bP:bL.Interpolate(bM.TransformTime((bR-bO)/bN),bP,bQ);},Duration:bN+bO};};O.Simple=function(bL,bM,bN,bO,bP){return{Compute:function(bQ){return bL.Interpolate(bM.TransformTime(bQ/bN),bO,bP);},Duration:bN};};O.Const=function(bL){return P.Const(bL);};O.Concat=function(bL){var bM;bM=o.Concat(by.map(P.List,bL));return new O({$:0,$0:bM});};O.Append=function(bL,bM){return new O({$:0,$0:o.Append(bL.$0,bM.$0)});};O.set_UseAnimations=function(bL){P.set_UseAnimations(bL);};O.get_UseAnimations=function(){return P.UseAnimations();};P.UseAnimations=function(){R.$cctor();return R.UseAnimations;};P.set_UseAnimations=function(bL){R.$cctor();R.UseAnimations=bL;};P.Actions=function(bL){var bM;return P.ConcatActions((bM=function(bN){return bN.$==1?{$:1,$0:bN.$0}:null;},function(bN){return bs.choose(bM,bN);}(o.ToArray(bL.$0))));};P.ConcatActions=function(bL){var bM,bN,bO,bP,bQ;bM=e.ofSeqNonCopying(bL);bN=bs.length(bM);return bN===0?P.Const():bN===1?bs.get(bM,0):(bO=by.max((bP=function(bR){return bR.Duration;},function(bR){return by.map(bP,bR);}(bM))),(bQ=bs.map(function(bR){return P.Prolong(bO,bR);},bM),P.Def(bO,function(bR){bs.iter(function(bS){bS.Compute(bR);},bQ);})));};P.Prolong=function(bL,bM){var bN,bO,bP;bN=bM.Compute;bO=bM.Duration;bP=bI.Create(function(){return bM.Compute(bM.Duration);});return{Compute:function(bQ){return bQ>=bO?bP.f():bN(bQ);},Duration:bL};};P.Const=function(bL){return P.Def(0,function(){return bL;});};P.Def=function(bL,bM){return{Compute:bM,Duration:bL};};P.Finalize=function(bL){var bM;bM=function(bN){if(bN.$==0)bN.$0();};(function(bN){bs.iter(bM,bN);}(o.ToArray(bL.$0)));};P.List=function(bL){return bL.$0;};Q=d.Trans=bA.Class({Copy:function(bL,bM,bN,bO){var bP,bQ,bR,bS,bT;bP=this;bQ=bG.DefaultArg(bL,bA.Curried2(bP.TChange));bR=bG.DefaultArg(bM,this.get_TEnter());bS=bG.DefaultArg(bN,this.get_TExit());bT=bG.DefaultArg(bO,this.get_TFlags());return new Q.New$3(function(bU,bV){return(bQ(bU))(bV);},bR,bS,bT);},get_TFlags:function(){return this.flags;},get_TExit:function(){return this.exit;},get_TEnter:function(){return this.enter;},TChange:function(bL,bM){return this.change(bL,bM);}},null,Q);Q.New=bA.Ctor(function(bL,bM,bN){Q.New$3.call(this,bL,bB.Equals(bM,null)?O.Const:bM,bB.Equals(bN,null)?O.Const:bN,1|(bB.Equals(bM,null)?0:2)|(bB.Equals(bN,null)?0:4));},Q);Q.New$1=bA.Ctor(function(bL){Q.New$3.call(this,bL,O.Const,O.Const,1);},Q);Q.New$2=bA.Ctor(function(){Q.New$3.call(this,function(bL,bM){return O.Const(bM);},O.Const,O.Const,0);},Q);Q.New$3=bA.Ctor(function(bL,bM,bN,bO){this.change=bL;this.enter=bM;this.exit=bN;this.flags=bO;null;},Q);Q.Exit=function(bL,bM){return bM.Copy(null,null,{$:1,$0:bL},{$:1,$0:bM.get_TFlags()|4});};Q.Enter=function(bL,bM){return bM.Copy(null,{$:1,$0:bL},null,{$:1,$0:bM.get_TFlags()|2});};Q.Change=function(bL,bM){return bM.Copy({$:1,$0:bL},null,null,{$:1,$0:bM.get_TFlags()|1});};Q.Create=function(bL){return new Q.New$1(bL);};Q.Trivial=function(){return new Q.New$2();};Q.CanAnimateExit=function(bL){var bM,bN;bM=bL.get_TFlags();bN=4;return(bM&bN)===bN;};Q.CanAnimateEnter=function(bL){var bM,bN;bM=bL.get_TFlags();bN=2;return(bM&bN)===bN;};Q.CanAnimateChange=function(bL){var bM,bN;bM=bL.get_TFlags();bN=1;return(bM&bN)===bN;};Q.AnimateExit=function(bL,bM){return(bL.get_TExit())(bM);};Q.AnimateEnter=function(bL,bM){return(bL.get_TEnter())(bM);};Q.AnimateChange=function(bL,bM,bN){return bL.TChange(bM,bN);};R.$cctor=bA.Cctor(function(){R.CubicInOut=M.Custom(function(bL){var bM;bM=bL*bL;return 3*bM-2*(bM*bL);});R.UseAnimations=true;R.$cctor=a.ignore;});S=d.AnimatedAttrNode=bA.Class({sync:function(bL){var bM;if(this.dirty){bM=this.logical;bM==null?null:(this.push(bL))(bM.$0);this.visible=this.logical;this.dirty=false;}},pushVisible:function(bL,bM){this.visible={$:1,$0:bM};this.dirty=true;(this.push(bL))(bM);},NChanged:function(){return this.updates;},NSync:function(bL){},NGetExitAnim:function(bL){var bM,bN,bO,bP;bM=this;bN=function(){bM.dirty=true;bM.visible=null;};return function(bQ){return O.WhenDone(bN,bQ);}((bO=this.visible,(bO!=null?bO.$==1:false)?O.Pack((bP=function(bQ){bM.pushVisible(bL,bQ);},function(bQ){return O.Map(bP,bQ);}(Q.AnimateExit(this.tr,bO.$0)))):O.get_Empty()));},NGetEnterAnim:function(bL){var bM,bN,bO,bP,bQ,bR,bS,bT;bM=this;bN=function(){bM.sync(bL);};return function(bU){return O.WhenDone(bN,bU);}((bO=this.visible,(bP=this.logical,((bO!=null?bO.$==1:false)?(bP!=null?bP.$==1:false)?this.dirty?(bQ=[bP.$0,bO.$0],true):false:false:false)?O.Pack((bR=function(bU){bM.pushVisible(bL,bU);},function(bU){return O.Map(bR,bU);}(Q.AnimateChange(this.tr,bQ[1],bQ[0])))):(bO==null?(bP!=null?bP.$==1:false)?true:false:false)?O.Pack((bT=function(bU){bM.pushVisible(bL,bU);},function(bU){return O.Map(bT,bU);}(Q.AnimateEnter(this.tr,bP.$0)))):O.get_Empty())));},NGetChangeAnim:function(bL){var bM,bN,bO,bP,bQ,bR;bM=this;bN=function(){bM.sync(bL);};return function(bS){return O.WhenDone(bN,bS);}((bO=this.visible,(bP=this.logical,((bO!=null?bO.$==1:false)?(bP!=null?bP.$==1:false)?this.dirty?(bQ=[bP.$0,bO.$0],true):false:false:false)?O.Pack((bR=function(bS){bM.pushVisible(bL,bS);},function(bS){return O.Map(bR,bS);}(Q.AnimateChange(this.tr,bQ[1],bQ[0])))):O.get_Empty())));}},null,S);S.New=bA.Ctor(function(bL,bM,bN){var bO,bP;bO=this;this.tr=bL;this.push=bN;this.logical=null;this.visible=null;this.dirty=true;this.updates=(bP=function(bQ){bO.logical={$:1,$0:bQ};bO.dirty=true;},function(bQ){return x.Map(bP,bQ);}(bM));null;},S);T=d.DynamicAttrNode=bA.Class({NChanged:function(){return this.updates;},NSync:function(bL){if(this.dirty){(this.push(bL))(this.value);this.dirty=false;}},NGetExitAnim:function(bL){return O.get_Empty();},NGetEnterAnim:function(bL){return O.get_Empty();},NGetChangeAnim:function(bL){return O.get_Empty();}},null,T);T.New=bA.Ctor(function(bL,bM){var bN,bO;bN=this;this.push=bM;this.value=void 0;this.dirty=false;this.updates=(bO=function(bP){bN.value=bP;bN.dirty=true;},function(bP){return x.Map(bO,bP);}(bL));null;},T);U=d.AttrProxy=bA.Class({},null,U);U.Handler=function(bL,bM){return Y.Static(function(bN){bN.addEventListener(bL,bM(bN),false);});};U.Concat=function(bL){var bM,bN;bM=e.ofSeqNonCopying(bL);bN=Y.EmptyAttr();return e.TreeReduce(bN,U.Append,bM);};U.Append=function(bL,bM){return Y.AppendTree(bL,bM);};U.Create=function(bL,bM){return Y.Static(function(bN){q.SetAttr(bN,bL,bM);});};X=W.Dyn=bA.Class({},null,X);X.New=function(bL,bM,bN,bO){var bP;return new X((bP={DynElem:bL,DynFlags:bM,DynNodes:bN},(bA.SetOptional(bP,"OnAfterRender",bO),bP)));};Y.Static=function(bL){return new U({$:3,$0:bL});};Y.Dynamic=function(bL,bM){return new U({$:1,$0:new T.New(bL,bM)});};Y.Animated=function(bL,bM,bN){var bO,bP,bQ;bO=new S.New(bL,bM,bN);bP=4;Q.CanAnimateEnter(bL)?void(bP=bP|1):null;Q.CanAnimateExit(bL)?void(bP=bP|2):null;bQ=new U({$:1,$0:bO});Y.SetFlags(bQ,bP);return bQ;};Y.EmptyAttr=function(){_1.$cctor();return _1.EmptyAttr;};Y.AppendTree=function(bL,bM){return bL===null?bM:bM===null?bL:new U({$:2,$0:bL,$1:bM});};Y.GetChangeAnim=function(bL){return Y.GetAnim(bL,function(bM,bN){return bM.NGetChangeAnim(bN);});};Y.GetExitAnim=function(bL){return Y.GetAnim(bL,function(bM,bN){return bM.NGetExitAnim(bN);});};Y.GetEnterAnim=function(bL){return Y.GetAnim(bL,function(bM,bN){return bM.NGetEnterAnim(bN);});};Y.GetAnim=function(bL,bM){var bN;return O.Concat((bN=function(bO){return bM(bO,bL.DynElem);},function(bO){return bs.map(bN,bO);}(bL.DynNodes)));};Y.Updates=function(bL){var bM,bN;bM=function(bO){return bO.NChanged();};return(bN=x.Const(),function(bO){return e.MapTreeReduce(bM,bN,x.Map2Unit,bO);})(bL.DynNodes);};Y.Insert=function(bL,bM){var bN,bO,bP;function bQ(bR){if(!(bR===null))if(bR!=null?bR.$==1:false)bN.push(bR.$0);else if(bR!=null?bR.$==2:false){bQ(bR.$0);bQ(bR.$1);}else if(bR!=null?bR.$==3:false)bR.$0(bL);else if(bR!=null?bR.$==4:false)bO.push(bR.$0);}bN=[];bO=[];bQ(bM);bP=bN.slice(0);return X.New(bL,Y.Flags(bM),bP,bO.length===0?null:{$:1,$0:function(bR){by.iter(function(bS){bS(bR);},bO);}});};Y.Sync=function(bL,bM){var bN;bN=function(bO){bO.NSync(bL);};(function(bO){bs.iter(bN,bO);}(bM.DynNodes));};Y.SetFlags=function(bL,bM){bL.flags=bM;};Y.Flags=function(bL){return(bL!==null?bL.hasOwnProperty("flags"):false)?bL.flags:0;};Y.HasExitAnim=function(bL){var bM;bM=2;return(bL.DynFlags&bM)===bM;};Y.HasEnterAnim=function(bL){var bM;bM=1;return(bL.DynFlags&bM)===bM;};Y.HasChangeAnim=function(bL){var bM;bM=4;return(bL.DynFlags&bM)===bM;};Z=d.CheckedInput=bA.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,Z);Z.Make=function(bL){return new Z({$:0,$0:bL,$1:a.String(bL)});};_0.ValidateForm=function(){return _0.OnAfterRender(function(bL){if(a.H5F)a.H5F.setup(bL);});};_0.Checked=function(bL){var bM;bM=function(bN){return!bB.Equals(bL.RVal(),bN.checked)?bL.set_RVal(bN.checked):null;};return U.Concat([_0.DynamicProp("checked",bL.RView()),_0.Handler("change",bA.Curried2(bM)),_0.Handler("click",bA.Curried2(bM))]);};_0.FloatValue=function(bL){return _0.CustomVar(bL,function(bM,bN){var bO;bO=bN.get_Input();return bM.value!==bO?void(bM.value=bO):null;},function(bM){var bN,bO;bN=bM.value;return{$:1,$0:f.isBlank(bN)?(bM.checkValidity?bM.checkValidity():true)?new Z({$:2,$0:bN}):new Z({$:1,$0:bN}):(bO=+bN,a.isNaN(bO)?new Z({$:1,$0:bN}):new Z({$:0,$0:bO,$1:bN}))};});};_0.FloatValueUnchecked=function(bL){return _0.CustomValue(bL,a.String,function(bM){var bN;return f.isBlank(bM)?{$:1,$0:0}:(bN=+bM,a.isNaN(bN)?null:{$:1,$0:bN});});};_0.IntValue=function(bL){return _0.CustomVar(bL,function(bM,bN){var bO;bO=bN.get_Input();return bM.value!==bO?void(bM.value=bO):null;},function(bM){var bN,bO;bN=bM.value;return{$:1,$0:f.isBlank(bN)?(bM.checkValidity?bM.checkValidity():true)?new Z({$:2,$0:bN}):new Z({$:1,$0:bN}):(bO=+bN,a.isNaN(bO)?new Z({$:1,$0:bN}):new Z({$:0,$0:bO<<0,$1:bN}))};});};_0.IntValueUnchecked=function(bL){return _0.CustomValue(bL,a.String,function(bM){var bN;return f.isBlank(bM)?{$:1,$0:0}:(bN=+bM,bN!==bN>>0?null:{$:1,$0:bN});});};_0.Value=function(bL){var bM,bN;return _0.CustomValue(bL,a.id,(bM=a.id,(bN=function(bO){return{$:1,$0:bO};},function(bO){return bN(bM(bO));})));};_0.ContentEditableHtml=function(bL){var bM,bN;bM=_0.CustomVar(bL,function(bO,bP){bO.innerHTML=bP;},function(bO){return{$:1,$0:bO.innerHTML};});bN=U.Create("contenteditable","true");return U.Append(bN,bM);};_0.ContentEditableText=function(bL){var bM,bN;bM=_0.CustomVar(bL,function(bO,bP){bO.textContent=bP;},function(bO){return{$:1,$0:bO.textContent};});bN=U.Create("contenteditable","true");return U.Append(bN,bM);};_0.CustomValue=function(bL,bM,bN){return _0.CustomVar(bL,function(bO,bP){bO.value=bM(bP);},function(bO){return bN(bO.value);});};_0.CustomVar=function(bL,bM,bN){var bO,bP;bO=function(bQ){return bL.RUpdM(function(bR){var bS,bT;bS=bN(bQ);return((bS!=null?bS.$==1:false)?!bB.Equals(bS.$0,bR)?(bT=[bS,bS.$0],true):false:false)?bT[0]:null;});};bP=function(bQ,bR){var bS,bT;bS=bN(bQ);return((bS!=null?bS.$==1:false)?bB.Equals(bS.$0,bR)?(bT=bS.$0,true):false:false)?null:bM(bQ,bR);};return U.Concat([_0.Handler("change",bA.Curried2(bO)),_0.Handler("input",bA.Curried2(bO)),_0.Handler("keypress",bA.Curried2(bO)),_0.DynamicCustom(bA.Curried2(bP),bL.RView())]);};_0.DynamicProp=function(bL,bM){return Y.Dynamic(bM,bA.Curried2(function(bN,bO){bN[bL]=bO;}));};_0.DynamicPred=function(bL,bM,bN){var bO,bP;bO=function(bQ,bR){return bR[0]?q.SetAttr(bQ,bL,bR[1]):q.RemoveAttr(bQ,bL);};bP=x.Map2(function(bQ,bR){return[bQ,bR];},bM,bN);return Y.Dynamic(bP,bA.Curried2(bO));};_0.DynamicClass=function(bL,bM,bN){return Y.Dynamic(bM,bA.Curried2(function(bO,bP){return bN(bP)?q.AddClass(bO,bL):q.RemoveClass(bO,bL);}));};_0.OnAfterRenderView=function(bL,bM){var bN,bO,bP;bN=h.Id();bO=_0.OnAfterRender(function(bQ){bM(bQ,bQ[bN]);});bP=_0.DynamicCustom(bA.Curried2(function(bQ,bR){bQ[bN]=bR;}),bL);return U.Append(bO,bP);};_0.OnAfterRender=function(bL){return new U({$:4,$0:bL});};_0.HandlerView=function(bL,bM,bN){return Y.Static(function(bO){var bP;bP=bN(bO);bO.addEventListener(bL,function(bQ){var bR;bR=bP(bQ);return x.Get(bR,bM);},false);});};_0.Handler=function(bL,bM){return Y.Static(function(bN){bN.addEventListener(bL,bM(bN),false);});};_0.DynamicStyle=function(bL,bM){return Y.Dynamic(bM,bA.Curried2(function(bN,bO){return q.SetStyle(bN,bL,bO);}));};_0.DynamicCustom=function(bL,bM){return Y.Dynamic(bM,bL);};_0.Dynamic=function(bL,bM){return Y.Dynamic(bM,bA.Curried2(function(bN,bO){return q.SetAttr(bN,bL,bO);}));};_0.AnimatedStyle=function(bL,bM,bN,bO){return Y.Animated(bM,bN,bA.Curried2(function(bP,bQ){return q.SetStyle(bP,bL,bO(bQ));}));};_0.Animated=function(bL,bM,bN,bO){return Y.Animated(bM,bN,bA.Curried2(function(bP,bQ){return q.SetAttr(bP,bL,bO(bQ));}));};_0.Class=function(bL){return Y.Static(function(bM){q.AddClass(bM,bL);});};_0.Style=function(bL,bM){return Y.Static(function(bN){q.SetStyle(bN,bL,bM);});};_1.$cctor=bA.Cctor(function(){_1.EmptyAttr=null;_1.$cctor=a.ignore;});_2=V.DocNode=bA.Class({},null,_2);_3=d.DocElemNode=bA.Class({GetHashCode:function(){return this.ElKey;},Equals:function(bL){return this.ElKey===bL.ElKey;}},null,_3);_3.New=function(bL,bM,bN,bO,bP,bQ){var bR;return new _3((bR={Attr:bL,Children:bM,El:bO,ElKey:bP},(bA.SetOptional(bR,"Delimiters",bN),bA.SetOptional(bR,"Render",bQ),bR)));};_5=_4.DomNodes=bA.Class({},null,_5);_5.FoldBack=function(bL,bM,bN){return bs.foldBack(bL,bM.$0,bN);};_5.Iter=function(bL,bM){bs.iter(bL,bM.$0);};_5.Except=function(bL,bM){var bN,bO,bP;bN=bL.$0;bO=(bP=function(bQ){var bR;bR=function(bS){return!(bQ===bS);};return function(bS){return bs.forall(bR,bS);}(bN);},function(bQ){return bs.filter(bP,bQ);}(bM.$0));return new _5({$:0,$0:bO});};_5.DocChildren=function(bL){var bM;function bN(bO){if(bO.$==2)bN(bO.$0.Current);else if(bO.$==1)bM.push(bO.$0.El);else if(bO.$==3);else if(bO.$==5)bM.push(bO.$0);else if(bO.$==4)bM.push(bO.$0.Text);else if(bO.$==6)bs.iter(function(bP){bM.push(bP);},bO.$0.Els);else{bN(bO.$0);bN(bO.$1);}}bM=[];bN(bL.Children);return new _5({$:0,$0:bM.slice(0)});};_5.Children=function(bL,bM){var bN,bO,bP,bQ;if(bM!=null?bM.$==1:false){bP=a.Array.prototype.constructor.apply(a.Array,[]);bN=bM.$0[0].nextSibling;while(bN!==bM.$0[1]){bQ=bP.push(bN);bN=bN.nextSibling;}return new _5({$:0,$0:bP});}else return new _5({$:0,$0:bs.init(bL.childNodes.length,(bO=bL.childNodes,function(bR){return bO[bR];}))});};_6=_4.NodeSet=bA.Class({},null,_6);_6.ToArray=function(bL){return i.ToArray(bL.$0);};_6.get_Empty=function(){return new _6({$:0,$0:new bx.New$3()});};_6.IsEmpty=function(bL){return bL.$0.get_Count()===0;};_6.Intersect=function(bL,bM){return new _6({$:0,$0:i.Intersect(bL.$0,bM.$0)});};_6.Except=function(bL,bM){return new _6({$:0,$0:i.Except(bL.$0,bM.$0)});};_6.FindAll=function(bL){var bM;function bN(bO){var bP,bQ;if(bO.$==0){bN(bO.$0);bN(bO.$1);}else if(bO.$==1){bP=bO.$0;bM.push(bP);bN(bP.Children);}else if(bO.$==2)bN(bO.$0.Current);else if(bO.$==6){bQ=function(bR){bN(bR.Children);};(function(bR){bs.iter(bQ,bR);}(bO.$0.Holes));}}bM=[];bN(bL);return new _6({$:0,$0:new bx.New$2(bM.slice(0))});};_6.Filter=function(bL,bM){return new _6({$:0,$0:i.Filter(bL,bM.$0)});};_7=_4.RunState=bA.Class({},null,_7);_7.New=function(bL,bM){return new _7({PreviousNodes:bL,Top:bM});};_8.TextHoleRE=function(){$.$cctor();return $.TextHoleRE;};_8.LoadedTemplates=function(){$.$cctor();return $.LoadedTemplates;};_8.UpdateTextNode=function(bL,bM){bL.Value=bM;bL.Dirty=true;};_8.CreateTextNode=function(){return{Text:q.CreateText(""),Dirty:false,Value:""};};_8.UpdateEmbedNode=function(bL,bM){bL.Current=bM;bL.Dirty=true;};_8.CreateEmbedNode=function(){return{Current:new _2({$:3}),Dirty:false};};_8.PerformAnimatedUpdate=function(bL,bM){var bN;return O.get_UseAnimations()?bC.Delay(function(){var bO,bP,bQ,bR,bS;bO=_6.FindAll(bM);bP=_8.ComputeChangeAnim(bL,bO);bQ=_8.ComputeEnterAnim(bL,bO);bR=_8.ComputeExitAnim(bL,bO);bS=O.Play(O.Append(bP,bR));return bC.Bind(bS,function(){var bT;_8.SyncElemNode(bL.Top);bT=O.Play(bQ);return bC.Bind(bT,function(){bL.PreviousNodes=bO;return bC.Return(null);});});}):(bN=function(bO){var bP;bP=a.requestAnimationFrame(function(){_8.SyncElemNode(bL.Top);bO();});},bC.FromContinuations(function(bO,bP,bQ){return bN.apply(null,[bO,bP,bQ]);}));};_8.ComputeEnterAnim=function(bL,bM){var bN,bO,bP;return O.Concat((bN=function(bQ){return Y.GetEnterAnim(bQ.Attr);},function(bQ){return bs.map(bN,bQ);}(_6.ToArray((bO=bL.PreviousNodes,function(bQ){return _6.Except(bO,bQ);}((bP=function(bQ){return Y.HasEnterAnim(bQ.Attr);},function(bQ){return _6.Filter(bP,bQ);}(bM))))))));};_8.ComputeChangeAnim=function(bL,bM){var bN,bO,bP,bQ,bR;bN=(bO=function(bS){return Y.HasChangeAnim(bS.Attr);},function(bS){return _6.Filter(bO,bS);});return O.Concat((bP=function(bS){return Y.GetChangeAnim(bS.Attr);},function(bS){return bs.map(bP,bS);}(_6.ToArray((bQ=bN(bL.PreviousNodes),(bR=bN(bM),_6.Intersect(bQ,bR)))))));};_8.ComputeExitAnim=function(bL,bM){var bN,bO,bP;return O.Concat((bN=function(bQ){return Y.GetExitAnim(bQ.Attr);},function(bQ){return bs.map(bN,bQ);}(_6.ToArray((bO=(bP=function(bQ){return Y.HasExitAnim(bQ.Attr);},function(bQ){return _6.Filter(bP,bQ);}(bL.PreviousNodes)),_6.Except(bM,bO))))));};_8.CreateDelimitedRunState=function(bL,bM,bN){return _7.New(_6.get_Empty(),_8.CreateDelimitedElemNode(bL,bM,Y.EmptyAttr(),bN));};_8.CreateRunState=function(bL,bM){return _7.New(_6.get_Empty(),_8.CreateElemNode(bL,Y.EmptyAttr(),bM));};_8.CreateDelimitedElemNode=function(bL,bM,bN,bO){var bP,bQ;bP=bL.parentNode;_8.LinkPrevElement(bM,bO);bQ=Y.Insert(bP,bN);return _3.New(bQ,bO,{$:1,$0:[bL,bM]},bP,h.Int(),bA.GetOptional(bQ.OnAfterRender));};_8.CreateElemNode=function(bL,bM,bN){var bO;_8.LinkElement(bL,bN);bO=Y.Insert(bL,bM);return _3.New(bO,bN,null,bL,h.Int(),bA.GetOptional(bO.OnAfterRender));};_8.SyncElemNode=function(bL){_8.SyncElement(bL);_8.Sync(bL.Children);_8.AfterRender(bL);};_8.Sync=function(bL){var bM,bN;function bO(bP){_8.SyncElement(bP);_8.Sync(bP.Children);_8.AfterRender(bP);}bL.$==1?bO(bL.$0):bL.$==2?_8.Sync(bL.$0.Current):bL.$==3?null:bL.$==5?null:bL.$==4?(bM=bL.$0,bM.Dirty?(bM.Text.nodeValue=bM.Value,bM.Dirty=false):null):bL.$==6?(bN=bL.$0,(bs.iter(bO,bN.Holes),bs.iter(function(bP){Y.Sync(bP[0],bP[1]);},bN.Attrs),_8.AfterRender(bN))):(_8.Sync(bL.$0),_8.Sync(bL.$1));};_8.AfterRender=function(bL){var bM;bM=bA.GetOptional(bL.Render);(bM!=null?bM.$==1:false)?(bM.$0(bL.El),bA.SetOptional(bL,"Render",null)):null;};_8.LinkPrevElement=function(bL,bM){var bN;bN=_8.InsertDoc(bL.parentNode,bM,new r({$:1,$0:bL}));};_8.LinkElement=function(bL,bM){var bN;bN=_8.InsertDoc(bL,bM,new r({$:0}));};_8.SyncElement=function(bL){function bM(bN){function bO(bP){var bQ;return bP.$==0?bO(bP.$0)?true:bO(bP.$1):bP.$==2?(bQ=bP.$0,bQ.Dirty?true:bO(bQ.Current)):bP.$==6?bs.exists(bM,bP.$0.Holes):false;}return bO(bN.Children);}Y.Sync(bL.El,bL.Attr);bM(bL)?_8.DoSyncElement(bL):null;};_8.DoSyncElement=function(bL){var bM,bN,bO,bP,bQ,bR,bS;function bT(bU,bV){var bW;return bU.$==1?new r({$:1,$0:bU.$0.El}):bU.$==2?(bW=bU.$0,bW.Dirty?(bW.Dirty=false,_8.InsertDoc(bM,bW.Current,bV)):bT(bW.Current,bV)):bU.$==3?bV:bU.$==4?new r({$:1,$0:bU.$0.Text}):bU.$==5?new r({$:1,$0:bU.$0}):bU.$==6?new r({$:1,$0:bs.get(bU.$0.Els,0)}):bT(bU.$0,bT(bU.$1,bV));}bM=bL.El;bN=_5.DocChildren(bL);bO=(bP=bL.El,function(bU){q.RemoveNode(bP,bU);});(function(bU){_5.Iter(bO,bU);}((bQ=_5.Children(bL.El,bA.GetOptional(bL.Delimiters)),_5.Except(bN,bQ))));bS=bT(bL.Children,(bR=bA.GetOptional(bL.Delimiters),(bR!=null?bR.$==1:false)?new r({$:1,$0:bR.$0[1]}):new r({$:0})));};_8.InsertDoc=function(bL,bM,bN){var bO;return bM.$==1?_8.InsertNode(bL,bM.$0.El,bN):bM.$==2?(bO=bM.$0,(bO.Dirty=false,_8.InsertDoc(bL,bO.Current,bN))):bM.$==3?bN:bM.$==4?_8.InsertNode(bL,bM.$0.Text,bN):bM.$==5?_8.InsertNode(bL,bM.$0,bN):bM.$==6?bs.foldBack(function(bP,bQ){return _8.InsertNode(bL,bP,bQ);},bM.$0.Els,bN):_8.InsertDoc(bL,bM.$0,_8.InsertDoc(bL,bM.$1,bN));};_8.InsertNode=function(bL,bM,bN){q.InsertAt(bL,bN,bM);return new r({$:1,$0:bM});};_9=d.Doc=bA.Class({ReplaceInDom:function(bL){var bM,bN;bM=a.document.createTextNode("");bN=bL.parentNode.replaceChild(bM,bL);_9.RunBefore(bM,this);}},null,_9);_9.Append=function(bL,bM){var bN,bO;bN=x.Map2Unit(bL.updates,bM.updates);bO=new _2({$:0,$0:bL.docNode,$1:bM.docNode});return _9.Mk(bO,bN);};_9.Concat=function(bL){var bM,bN;bM=e.ofSeqNonCopying(bL);bN=_9.Empty();return e.TreeReduce(bN,_9.Append,bM);};_9.Empty=function(){var bL,bM;bL=new _2({$:3});bM=x.Const();return _9.Mk(bL,bM);};_9.TextNode=function(bL){var bM,bN;bM=new _2({$:5,$0:q.CreateText(bL)});bN=x.Const();return _9.Mk(bM,bN);};_9.Verbatim=function(bL){var bM,bN,bO,bP;bM=(bN=a.jQuery.parseHTML(bL),bB.Equals(bN,null)?[]:bN);bO=e.MapTreeReduce(function(bQ){return bB.Equals(bQ.nodeType,a.Node.TEXT_NODE)?new _2({$:5,$0:bQ}):new _2({$:1,$0:_8.CreateElemNode(bQ,Y.EmptyAttr(),new _2({$:3}))});},new _2({$:3}),function(bQ,bR){return new _2({$:0,$0:bQ,$1:bR});},bM);bP=x.Const();return _9.Mk(bO,bP);};_9.SvgElementMixed=function(bL,bM){var bN;bN=_9.MixedNodes(bM);return _9.SvgElement(bL,bN[0],bN[1]);};_9.SvgElement=function(bL,bM,bN){var bO,bP,bQ;bO=U.Concat(bM);bP=_9.Concat(bN);bQ=q.CreateSvgElement(bL);return _.New(bQ,bO,bP);};_9.ElementMixed=function(bL,bM){var bN;bN=_9.MixedNodes(bM);return _9.Element(bL,bN[0],bN[1]);};_9.ConcatMixed=function(bL){return _9.Concat(by.map(_9.ToMixedDoc,bL));};_9.MixedNodes=function(bL){var bM,bN,bO,bP;bM=new bF.New$2();bN=new bF.New$2();bO=bt.Get(bL);try{while(bO.MoveNext()){bP=bO.Current();bP instanceof U?bM.Add(bP):bN.Add(_9.ToMixedDoc(bP));}}finally{if("Dispose"in bO)bO.Dispose();}return[bM,bN];};_9.ToMixedDoc=function(bL){return bL instanceof _9?bL:typeof bL=="string"?_9.TextNode(bL):bL instanceof a.Element?_9.Static(bL):typeof bL=="function"?_9.EmbedView(x.Map(_9.ToMixedDoc,bL)):bL instanceof y?_9.EmbedView(x.Map(_9.ToMixedDoc,bL.v)):bB.Equals(bL,null)?_9.Empty():_9.TextNode(a.String(bL));};_9.Element=function(bL,bM,bN){var bO,bP,bQ;bO=U.Concat(bM);bP=_9.Concat(bN);bQ=q.CreateElement(bL);return _.New(bQ,bO,bP);};_9.Radio=function(bL,bM,bN){var bO,bP,bQ,bR,bS,bT,bU;bO=q.CreateElement("input");bO.addEventListener("click",function(){return bN.RSet(bM);},false);bP=(bQ=bN.RView(),x.Map(function(bV){return bB.Equals(bV,bM);},bQ));bR=_0.DynamicProp("checked",bP);bS=U.Create;bT=U.Concat(br.append(br.ofArray([bS("type","radio"),bS("name",bN.RId()),bR]),br.ofSeq(bL)));bU=_9.Empty();return _.New(bO,bT,bU);};_9.LinkView=function(bL,bM,bN,bO){var bP,bQ,bR,bS;bP=_0.HandlerView("click",bN,bA.Curried2(function(bT,bU){return bO;}));bQ=U.Concat(by.append([bP,U.Create("href","#")],bM));bR=q.CreateElement("a");bS=_9.TextNode(bL);return _.New(bR,bQ,bS);};_9.Link=function(bL,bM,bN){var bO,bP,bQ,bR,bS;bO=(bP=U.Concat(bM),(bQ=U.Create("href","#"),U.Append(bQ,bP)));bR=_9.Clickable("a",bN);bS=_9.TextNode(bL);return _.New(bR,bO,bS);};_9.ButtonView=function(bL,bM,bN,bO){var bP,bQ,bR,bS;bP=_0.HandlerView("click",bN,bA.Curried2(function(bT,bU){return bO;}));bQ=U.Concat(by.append([bP],bM));bR=q.CreateElement("button");bS=_9.TextNode(bL);return _.New(bR,bQ,bS);};_9.Button=function(bL,bM,bN){var bO,bP,bQ;bO=U.Concat(bM);bP=_9.Clickable("button",bN);bQ=_9.TextNode(bL);return _.New(bP,bO,bQ);};_9.Clickable=function(bL,bM){var bN;bN=q.CreateElement(bL);bN.addEventListener("click",function(bO){bO.preventDefault();return bM();},false);return bN;};_9.CheckBoxGroup=function(bL,bM,bN){var bO,bP,bQ;bO=(bP=function(bR,bS){return bS?br.exists(function(bT){return bB.Equals(bM,bT);},bR)?bR:new br.T({$:1,$0:bM,$1:bR}):br.filter(function(bT){return!bB.Equals(bM,bT);},bR);},y.Lens(bN,(bQ=function(bR){return bB.Equals(bM,bR);},function(bR){return br.exists(bQ,bR);}),function(bR,bS){return bP(bR,bS);}));return _9.CheckBox(bL,bO);};_9.CheckBox=function(bL,bM){return _9.InputInternal("input",function(){return by.append(bL,[U.Create("type","checkbox"),_0.Checked(bM)]);});};_9.SelectDynOptional=function(bL,bM,bN,bO,bP){var bQ,bR;bQ=(bR=function(bS){return new br.T({$:1,$0:null,$1:br.map(function(bT){return{$:1,$0:bT};},bS)});},function(bS){return x.Map(bR,bS);}(bO));return _9.SelectDyn(bL,function(bS){return(bS!=null?bS.$==1:false)?bN(bS.$0):bM;},bQ,bP);};_9.SelectOptional=function(bL,bM,bN,bO,bP){var bQ;bQ=new br.T({$:1,$0:null,$1:br.map(function(bR){return{$:1,$0:bR};},bO)});return _9.Select(bL,function(bR){return(bR!=null?bR.$==1:false)?bN(bR.$0):bM;},bQ,bP);};_9.Select=function(bL,bM,bN,bO){return _9.SelectImpl(bL,bM,function(bP){var bQ;bP[0]=bN;return _9.Concat((bQ=function(bR,bS){var bT,bU;bT=br.ofArray([U.Create("value",a.String(bR))]);bU=br.ofArray([_9.TextNode(bM(bS))]);return _9.Element("option",bT,bU);},function(bR){return br.mapi(bQ,bR);}(bN)));},bO);};_9.SelectDyn=function(bL,bM,bN,bO){return _9.SelectImpl(bL,bM,function(bP){var bQ,bR;bQ=function(bS,bT){var bU,bV;bU=br.ofArray([U.Create("value",a.String(bS))]);bV=br.ofArray([_9.TextNode(bM(bT))]);return _9.Element("option",bU,bV);};return function(bS){return _9.Convert(function(bT){return bQ(bT[0],bT[1]);},bS);}((bR=function(bS){var bT;bP[0]=bS;bT=function(bU,bV){return[bU,bV];};return function(bU){return by.mapi(bT,bU);}(bS);},function(bS){return x.Map(bR,bS);}(bN)));},bO);};_9.SelectImpl=function(bL,bM,bN,bO){var bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2;bP=[new br.T({$:0})];bQ=function(b3){return b3.selectedIndex;};bR=function(b3,b4){b3.selectedIndex=b4;};bS=function(b3){return bP[0].get_Item(bQ(b3));};bT=function(b3){return by.findIndex(function(b4){return bB.Equals(b3,b4);},bP[0]);};bU=function(b3,b4){return bR(b3,bT(b4));};bV=q.CreateElement("select");bW=(bX=bO.RView(),_0.DynamicCustom(bA.Curried2(bU),bX));bV.addEventListener("change",function(){bO.RUpdM(function(b3){var b4;b4=bS(bV);return bB.Equals(b3,b4)?null:{$:1,$0:b4};});},false);bY=(bZ=(b0=U.Concat(bL),U.Append(bW,b0)),(b1=_0.OnAfterRender(function(b3){bU(b3,bO.RGet());}),U.Append(b1,bZ)));b2=bN(bP);return _.New(bV,bY,b2);};_9.InputArea=function(bL,bM){return _9.InputInternal("textarea",function(){return by.append(bL,[_0.Value(bM)]);});};_9.FloatInput=function(bL,bM){return _9.InputInternal("input",function(){return by.append(bL,[_0.FloatValue(bM),U.Create("type","number")]);});};_9.FloatInputUnchecked=function(bL,bM){return _9.InputInternal("input",function(){return by.append(bL,[bM.RGet()===0?U.Create("value","0"):Y.EmptyAttr(),_0.FloatValueUnchecked(bM),U.Create("type","number")]);});};_9.IntInput=function(bL,bM){return _9.InputInternal("input",function(){return by.append(bL,[_0.IntValue(bM),U.Create("type","number")]);});};_9.IntInputUnchecked=function(bL,bM){return _9.InputInternal("input",function(){return by.append(bL,[bM.RGet()===0?U.Create("value","0"):Y.EmptyAttr(),_0.IntValueUnchecked(bM),U.Create("type","number")]);});};_9.PasswordBox=function(bL,bM){return _9.InputInternal("input",function(){return by.append(bL,[_0.Value(bM),U.Create("type","password")]);});};_9.Input=function(bL,bM){return _9.InputInternal("input",function(){return by.append(bL,[_0.Value(bM)]);});};_9.InputInternal=function(bL,bM){var bN,bO,bP;bN=q.CreateElement(bL);bO=U.Concat(bM(bN));bP=_9.Empty();return _.New(bN,bO,bP);};_9.ConvertSeqBy=function(bL,bM,bN){return _9.Flatten(x.MapSeqCachedViewBy(bL,function(bO,bP){return(bM(bO))(bP);},bN));};_9.ConvertSeq=function(bL,bM){return _9.Flatten(x.MapSeqCachedView(bL,bM));};_9.ConvertBy=function(bL,bM,bN){return _9.Flatten(x.MapSeqCachedBy(bL,bM,bN));};_9.Convert=function(bL,bM){return _9.Flatten(x.MapSeqCached(bL,bM));};_9.Flatten=function(bL){return _9.EmbedView(x.Map(_9.Concat,bL));};_9.GetOrLoadTemplate=function(bL,bM,bN,bO){_9.PrepareTemplate(bL,bM,bN);return _9.NamedTemplate(bL,bM,bO);};_9.NamedTemplate=function(bL,bM,bN){var bO,bP,bQ,bR;bO=_9.ComposeName(bL,bM);bP=(bQ=null,[_8.LoadedTemplates().TryGetValue(bO,{get:function(){return bQ;},set:function(bS){bQ=bS;}}),bQ]);return bP[0]?(bR=bP[1].cloneNode(true),_9.ChildrenTemplate(bR,bN)):(a.console.warn.apply(a.console,["Local template doesn't exist"].concat([bO])),_9.Empty());};_9.LoadLocalTemplates=function(bL){(function(){var bM,bN,bO,bP,bQ;while(true){bN=a.document.querySelector("[ws-template]");if(bB.Equals(bN,null)){bO=a.document.querySelector("[ws-children-template]");if(bB.Equals(bO,null))return null;else{bP=bO.getAttribute("ws-children-template");bO.removeAttribute("ws-children-template");bM=q.ChildrenArray(bO);_9.PrepareTemplateStrict(bL,{$:1,$0:bP},bM);}}else{bQ=bN.getAttribute("ws-template");bN.removeAttribute("ws-template");_9.PrepareSingleTemplate(bL,{$:1,$0:bQ},bN);}}}());};_9.PrepareTemplate=function(bL,bM,bN){var bO;if(!_8.LoadedTemplates().ContainsKey(_9.ComposeName(bL,bM))){bO=bN();_9.PrepareTemplateStrict(bL,bM,bO);}};_9.PrepareTemplateStrict=function(bL,bM,bN){var bO,bP;function bQ(bR,bS){var bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4;if(bS!==null){if(bB.Equals(bS.nodeType,a.Node.TEXT_NODE)){bT=null;bU=0;b0=bS.textContent;b1=(bW=_8.TextHoleRE(),new a.RegExp(bW,"g"));while(bT=b1.exec(b0),bT!==null){b2=bS.parentNode.insertBefore(a.document.createTextNode(bK.string(b0,{$:1,$0:bU},{$:1,$0:b1.lastIndex-bs.get(bT,0).length-1})),bS);bU=b1.lastIndex;b3=a.document.createElement("span");b3.setAttribute("ws-replace",bs.get(bT,1));b4=bS.parentNode.insertBefore(b3,bS);}b1.lastIndex=0;bS.textContent=bK.string(b0,{$:1,$0:bU},null);}else if(bB.Equals(bS.nodeType,a.Node.ELEMENT_NODE)){bO(bS);bX=bS.getAttribute("ws-template");bX===null?(bY=bS.getAttribute("ws-children-template"),bY===null?bQ(bS,bS.firstChild):(bS.removeAttribute("ws-children-template"),bZ=q.ChildrenArray(bS),_9.PrepareTemplateStrict(bL,{$:1,$0:bY},bZ))):_9.PrepareSingleTemplate(bL,{$:1,$0:bX},bS);}return bQ(bR,bS.nextSibling);}else return null;}bO=function(bR){var bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4;bS=bR.attributes;bT=[];bU=[];bV=[];for(bW=0,bX=bS.length-1;bW<=bX;bW++){bY=bS.item(bW);((bZ=bY.nodeName,bu.StartsWith(bZ,"ws-on"))?bY.nodeName!=="ws-onafterrender":false)?(b0=bT.push(bY.nodeName),void 0,(b1=bU.push(bK.string(bY.nodeName,{$:1,$0:"ws-on".length},null)+":"+bY.nodeValue),void 0)):(!(b2=bY.nodeName,bu.StartsWith(b2,"ws-"))?(b3=_8.TextHoleRE(),new a.RegExp(b3)).test(bY.nodeValue):false)?(b4=bV.push(bY.nodeName),void 0):null;}!(bU.length==0)?bR.setAttribute("ws-on",bu.concat(" ",bU)):null;!(bV.length==0)?bR.setAttribute("ws-attr-holes",bu.concat(" ",bV)):null;bs.iter(function(b5){bR.removeAttribute(b5);},bT);};bP=_9.FakeRoot(bN);_8.LoadedTemplates().Add(_9.ComposeName(bL,bM),bP);bQ(bP,bs.get(bN,0));};_9.ComposeName=function(bL,bM){return bL+"/"+bG.DefaultArg(bM,"");};_9.PrepareSingleTemplate=function(bL,bM,bN){var bO,bP,bQ,bR;bN.removeAttribute("ws-template");bO=bN.getAttribute("ws-replace");bO===null?null:(bN.removeAttribute("ws-replace"),(bP=bN.parentNode,bB.Equals(bP,null)?null:(bQ=a.document.createElement(bN.tagName),(bQ.setAttribute("ws-replace",bO),(bR=bP.insertBefore(bQ,bN),void 0)))));_9.PrepareTemplateStrict(bL,bM,[bN]);};_9.FakeRoot=function(bL){var bM,bN,bO,bP;bM=a.document.createElement("div");for(bN=0,bO=bL.length-1;bN<=bO;bN++){bP=bM.appendChild(bs.get(bL,bN));}return bM;};_9.ChildrenTemplate=function(bL,bM){var bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ;bT=[];bU=[];bV=[];bW=[];bX=new bJ.New$5();bY=bt.Get(bM);try{while(bY.MoveNext()){bZ=bY.Current();bX.set_Item(bZ.$0,bZ);}}finally{if("Dispose"in bY)bY.Dispose();}bN=function(b0,b1){var b2,b3,b4,b5;b2=Y.Insert(b0,b1);b3=bU.push(Y.Updates(b2));b4=bV.push([b0,b2]);b5=function(b6){var b7;b7=bW.push(function(){b6(b0);});};return function(b6){if(b6==null);else b5(b6.$0);}(bA.GetOptional(b2.OnAfterRender));};bO=function(b0){var b1,b2,b3,b4,b5,b6,b7,b8;b3=(b1=null,[bX.TryGetValue(b0,{get:function(){return b1;},set:function(b9){b1=b9;}}),b1]);switch(b3[0]?b3[1].$==0?0:b3[1].$==1?1:b3[1].$==2?2:b3[1].$==6?3:b3[1].$==7?4:b3[1].$==8?5:b3[1].$==9?6:b3[1].$==10?7:b3[1].$==11?8:9:9){case 0:return{$:1,$0:b3[1].$1};break;case 1:return{$:1,$0:_9.TextNode(b3[1].$1)};break;case 2:return{$:1,$0:_9.TextView(b3[1].$1)};break;case 3:return{$:1,$0:_9.TextView(b3[1].$1.RView())};break;case 4:return{$:1,$0:_9.TextView((b4=b3[1].$1.RView(),x.Map(a.String,b4)))};break;case 5:return{$:1,$0:_9.TextView((b5=b3[1].$1.RView(),x.Map(function(b9){return b9.get_Input();},b5)))};break;case 6:return{$:1,$0:_9.TextView((b6=b3[1].$1.RView(),x.Map(a.String,b6)))};break;case 7:return{$:1,$0:_9.TextView((b7=b3[1].$1.RView(),x.Map(function(b9){return b9.get_Input();},b7)))};break;case 8:return{$:1,$0:_9.TextView((b8=b3[1].$1.RView(),x.Map(a.String,b8)))};break;case 9:return null;break;}};q.IterSelector(bL,"[ws-hole]",function(b0){var b1,b2,b3,b4,b5,b6;b3=b0.getAttribute("ws-hole");b4=bO(b3);if(b4!=null?b4.$==1:false){b5=b4.$0;b0.removeAttribute("ws-hole");while(b0.lastChild!==null){b6=b0.removeChild(b0.lastChild);}_8.LinkElement(b0,b5.docNode);b1=bT.push(_3.New(Y.Insert(b0,Y.EmptyAttr()),b5.docNode,null,b0,h.Int(),null));b2=bU.push(b5.updates);}else a.console.warn.apply(a.console,["Unfilled hole"].concat([b3]));});q.IterSelector(bL,"[ws-replace]",function(b0){var b1,b2,b3,b4,b5,b6,b7,b8;b1=b0.getAttribute("ws-replace");b2=bO(b1);(b2!=null?b2.$==1:false)?(b3=b2.$0,(b0.removeAttribute("ws-replace"),(b4=b0.parentNode,(b5=b0.nextSibling,bB.Equals(b5,null)?_8.LinkElement(b4,b3.docNode):_8.LinkPrevElement(b5,b3.docNode),(b6=b4.removeChild(b0),void 0),(b7=bT.push(_3.New(Y.Insert(b4,Y.EmptyAttr()),b3.docNode,null,b4,h.Int(),null)),void 0),(b8=bU.push(b3.updates),void 0))))):a.console.warn.apply(a.console,["Unfilled replace"].concat([b1]));});q.IterSelector(bL,"[ws-attr]",function(b0){var b1,b2,b3,b4;b1=b0.getAttribute("ws-attr");b2=(b3=null,[bX.TryGetValue(b1,{get:function(){return b3;},set:function(b5){b3=b5;}}),b3]);(b2[0]?b2[1].$==3?true:false:false)?(b0.removeAttribute("ws-attr"),bN(b0,b2[1].$1)):a.console.warn.apply(a.console,["Unfilled attr"].concat([b1]));});q.IterSelector(bL,"[ws-on]",function(b0){var b1,b2;bN(b0,U.Concat((b1=function(b3){var b4,b5,b6,b7,b8,b9;b4=bu.SplitChars(b3,[58],0);b5=(b6=null,[bX.TryGetValue(bs.get(b4,1),{get:function(){return b6;},set:function(b_){b6=b_;}}),b6]);return(b5[0]?b5[1].$==4?true:false:false)?{$:1,$0:_0.Handler(bs.get(b4,0),b5[1].$1)}:(b8="Unfilled on"+bs.get(b4,0),(b9=[bs.get(b4,1)],a.console.warn.apply(a.console,[b8].concat(b9))),null);},function(b3){return bs.choose(b1,b3);}((b2=b0.getAttribute("ws-on"),bu.SplitChars(b2,[32],0))))));b0.removeAttribute("ws-on");});q.IterSelector(bL,"[ws-onafterrender]",function(b0){var b1,b2,b3,b4;b1=b0.getAttribute("ws-onafterrender");b2=(b3=null,[bX.TryGetValue(b1,{get:function(){return b3;},set:function(b5){b3=b5;}}),b3]);(b2[0]?b2[1].$==5?true:false:false)?(b0.removeAttribute("ws-onafterrender"),bN(b0,_0.OnAfterRender(b2[1].$1))):a.console.log.apply(a.console,["Unfilled onafterrender"].concat([b1]));});q.IterSelector(bL,"[ws-var]",function(b0){var b1,b2,b3,b4;b3=b0.getAttribute("ws-var");b0.removeAttribute("ws-var");b4=(b1=null,[bX.TryGetValue(b3,{get:function(){return b1;},set:function(b5){b1=b5;}}),b1]);switch(b4[0]?b4[1].$==6?0:b4[1].$==7?1:b4[1].$==8?2:b4[1].$==9?3:b4[1].$==10?4:b4[1].$==11?5:6:6){case 0:bN(b0,_0.Value(b4[1].$1));break;case 1:bN(b0,_0.Checked(b4[1].$1));break;case 2:bN(b0,_0.IntValue(b4[1].$1));break;case 3:bN(b0,_0.IntValueUnchecked(b4[1].$1));break;case 4:bN(b0,_0.FloatValue(b4[1].$1));break;case 5:bN(b0,_0.FloatValueUnchecked(b4[1].$1));break;case 6:a.console.warn.apply(a.console,["Unfilled var"].concat([b3]));break;}});q.IterSelector(bL,"[ws-attr-holes]",function(b0){var b1,b2,b3,b4,b5,b6;b3=(b1=_8.TextHoleRE(),new a.RegExp(b1,"g"));b4=(b2=b0.getAttribute("ws-attr-holes"),bu.SplitChars(b2,[32],0));b0.removeAttribute("ws-attr-holes");for(b5=0,b6=b4.length-1;b5<=b6;b5++)(function(){var b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl;ch=bs.get(b4,b5);ci=b0.getAttribute(ch);b7=null;b8=0;cj=[];while(b7=b3.exec(ci),b7!==null){ck=bK.string(ci,{$:1,$0:b8},{$:1,$0:b3.lastIndex-bs.get(b7,0).length-1});b8=b3.lastIndex;cl=cj.push([ck,bs.get(b7,1)]);}b_=bK.string(ci,{$:1,$0:b8},null);b3.lastIndex=0;b$=(ca=[b_,new br.T({$:0})],((cb=function(cm,cn){return function(co){var cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB;cu=co[0];cv=co[1];cw=(cq=null,[bX.TryGetValue(cn,{get:function(){return cq;},set:function(cC){cq=cC;}}),cq]);switch(cw[0]?cw[1].$==1?0:cw[1].$==2?1:cw[1].$==6?2:cw[1].$==7?3:cw[1].$==8?4:cw[1].$==9?5:cw[1].$==10?6:cw[1].$==11?7:8:8){case 0:cp={$:0,$0:cw[1].$1};break;case 1:cp={$:1,$0:cw[1].$1};break;case 2:cp={$:1,$0:cw[1].$1.RView()};break;case 3:cp={$:1,$0:(cx=cw[1].$1.RView(),x.Map(a.String,cx))};break;case 4:cp={$:1,$0:(cy=cw[1].$1.RView(),x.Map(function(cC){return cC.get_Input();},cy))};break;case 5:cp={$:1,$0:(cz=cw[1].$1.RView(),x.Map(a.String,cz))};break;case 6:cp={$:1,$0:(cA=cw[1].$1.RView(),x.Map(function(cC){return cC.get_Input();},cA))};break;case 7:cp={$:1,$0:(cB=cw[1].$1.RView(),x.Map(a.String,cB))};break;case 8:cp=(a.console.warn("${View} in attribute value not implemented yet"),{$:0,$0:""});break;}return cp.$==1?(cs=cp.$0,ct=cu===""?cs:x.Map(function(cC){return cC+cu;},cs),[cm,new br.T({$:1,$0:ct,$1:cv})]):[cm+cp.$0+cu,cv];};},(bA.Curried3(bs.foldBack))(function(cm,cn){return(function(co){return cb(co[0],co[1]);}(cm))(cn);}))(cj))(ca));return bN(b0,b$[1].$==1?b$[1].$1.$==1?b$[1].$1.$1.$==0?(cc=b$[0],_0.Dynamic(ch,x.Map2(function(cm,cn){return cc+cm+cn;},b$[1].$0,b$[1].$1.$0))):(cd=b$[0],ce=(cf=function(cm){return cd+bu.concat("",cm);},function(cm){return x.Map(cf,cm);}(x.Sequence(b$[1]))),_0.Dynamic(ch,ce)):b$[0]===""?_0.Dynamic(ch,b$[1].$0):(cg=b$[0],_0.Dynamic(ch,x.Map(function(cm){return cg+cm;},b$[1].$0))):U.Create(ch,b$[0]));}());});bP=(bQ=x.Const(),function(b0){return e.TreeReduce(bQ,x.Map2Unit,b0);}(bU));bR=new _2({$:6,$0:bA.DeleteEmptyFields({Els:q.ChildrenArray(bL),Holes:bT,Attrs:bV,Render:(bS=bW.length==0?null:{$:1,$0:function(b0){bs.iter(function(b1){b1(b0);},bW);}},bS?bS.$0:void 0)},["Render"])});return _9.Mk(bR,bP);};_9.Template=function(bL,bM){var bN;bN=_9.FakeRoot(bL);return _9.ChildrenTemplate(bN,bM);};_9.TextView=function(bL){var bM,bN,bO,bP;bM=_8.CreateTextNode();bN=(bO=function(bQ){_8.UpdateTextNode(bM,bQ);},function(bQ){return x.Map(bO,bQ);}(bL));bP=new _2({$:4,$0:bM});return _9.Mk(bP,bN);};_9.RunReplaceById=function(bL,bM){var bN;bN=q.Doc().getElementById(bL);bB.Equals(bN,null)?bG.FailWith("invalid id: "+bL):bM.ReplaceInDom(bN);};_9.RunById=function(bL,bM){var bN;bN=q.Doc().getElementById(bL);bB.Equals(bN,null)?bG.FailWith("invalid id: "+bL):_9.Run(bN,bM);};_9.Run=function(bL,bM){var bN,bO,bP;bN=bM.docNode;_8.LinkElement(bL,bN);bO=_8.CreateRunState(bL,bN);bP=m.StartProcessor(_8.PerformAnimatedUpdate(bO,bN));x.Sink(bP,bM.updates);};_9.RunPrependById=function(bL,bM){var bN;bN=q.Doc().getElementById(bL);bB.Equals(bN,null)?bG.FailWith("invalid id: "+bL):_9.RunPrepend(bN,bM);};_9.RunPrepend=function(bL,bM){var bN,bO;bN=a.document.createTextNode("");bO=bL.insertBefore(bN,bL.firstChild);_9.RunBefore(bN,bM);};_9.RunAppendById=function(bL,bM){var bN;bN=q.Doc().getElementById(bL);bB.Equals(bN,null)?bG.FailWith("invalid id: "+bL):_9.RunAppend(bN,bM);};_9.RunAppend=function(bL,bM){var bN,bO;bN=a.document.createTextNode("");bO=bL.appendChild(bN);_9.RunBefore(bN,bM);};_9.RunAfterById=function(bL,bM){var bN;bN=q.Doc().getElementById(bL);bB.Equals(bN,null)?bG.FailWith("invalid id: "+bL):_9.RunAfter(bN,bM);};_9.RunAfter=function(bL,bM){var bN,bO;bN=a.document.createTextNode("");bO=bL.parentNode.insertBefore(bN,bL.nextSibling);_9.RunBetween(bL,bN,bM);};_9.RunBeforeById=function(bL,bM){var bN;bN=q.Doc().getElementById(bL);bB.Equals(bN,null)?bG.FailWith("invalid id: "+bL):_9.RunBefore(bN,bM);};_9.RunBefore=function(bL,bM){var bN,bO;bN=a.document.createTextNode("");bO=bL.parentNode.insertBefore(bN,bL);_9.RunBetween(bN,bL,bM);};_9.RunBetween=function(bL,bM,bN){var bO,bP;_8.LinkPrevElement(bM,bN.docNode);bO=_8.CreateDelimitedRunState(bL,bM,bN.docNode);bP=m.StartProcessor(_8.PerformAnimatedUpdate(bO,bN.docNode));x.Sink(bP,bN.updates);};_9.Async=function(bL){var bM;return _9.EmbedView((bM=a.id,function(bN){return x.MapAsync(bM,bN);}(x.Const(bL))));};_9.BindView=function(bL,bM){return _9.EmbedView(x.Map(bL,bM));};_9.EmbedView=function(bL){var bM,bN,bO,bP,bQ;bM=_8.CreateEmbedNode();bN=(bO=function(){},function(bR){return x.Map(bO,bR);}((bP=function(bR){_8.UpdateEmbedNode(bM,bR.docNode);return bR.updates;},function(bR){return x.Bind(bP,bR);}(bL))));bQ=new _2({$:2,$0:bM});return _9.Mk(bQ,bN);};_9.Static=function(bL){var bM,bN;bM=Y.EmptyAttr();bN=_9.Empty();return _.New(bL,bM,bN);};_9.Mk=function(bL,bM){return new _9.New(bL,bM);};_9.New=bA.Ctor(function(bL,bM){this.docNode=bL;this.updates=bM;null;},_9);_=d.Elt=bA.Class({AddClass:function(bL){return this.elt.className+=" "+bL;},SetStyle:function(bL,bM){this.elt.style[bL]=bM;},HasClass:function(bL){return(new a.RegExp("(\\s|^)"+bL+"(\\s|$)")).test(this.elt.className);},RemoveClass:function(bL){this.elt.className=this.elt.className.replace(new a.RegExp("(?:(\\s|^)"+bL+")+(\\s|$)","g"),"$1");},GetProperty:function(bL){return this.elt[bL];},SetProperty:function(bL,bM){this.elt[bL]=bM;},RemoveAttribute:function(bL){this.elt.removeAttribute(bL);},HasAttribute:function(bL){return this.elt.hasAttribute(bL);},GetAttribute:function(bL){return this.elt.getAttribute(bL);},SetAttribute:function(bL,bM){this.elt.setAttribute(bL,bM);},SetText:function(bL){var bM;this.get_DocElemNode().Children=new _2({$:3});bM=x.Const();y.Set(this.rvUpdates,bM);this.elt.textContent=bL;},GetText:function(){return this.elt.textContent;},SetValue:function(bL){this.elt.value=bL;},GetValue:function(){return this.elt.value;},Id:function(){return this.elt.id;},Html:function(){return this.elt.outerHTML;},Clear:function(){var bL,bM;this.get_DocElemNode().Children=new _2({$:3});bL=x.Const();y.Set(this.rvUpdates,bL);while(this.elt.hasChildNodes()){bM=this.elt.removeChild(this.elt.firstChild);}},Prepend:function(bL){var bM,bN,bO,bP,bQ;bM=this.get_DocElemNode();bM.Children=new _2({$:0,$0:bL.docNode,$1:bM.Children});bN=x.Map2Unit(this.rvUpdates.c,bL.updates);y.Set(this.rvUpdates,bN);bO=(bP=this.elt.firstChild,bB.Equals(bP,null)?new r({$:0}):new r({$:1,$0:bP}));bQ=_8.InsertDoc(this.elt,bL.docNode,bO);},Append:function(bL){var bM,bN,bO;bM=this.get_DocElemNode();bM.Children=new _2({$:0,$0:bM.Children,$1:bL.docNode});bN=x.Map2Unit(this.rvUpdates.c,bL.updates);y.Set(this.rvUpdates,bN);bO=_8.InsertDoc(this.elt,bL.docNode,new r({$:0}));},get_DocElemNode:function(){var bL;bL=this.docNode$1;return bL.$==1?bL.$0:bG.FailWith("Elt: Invalid docNode");},OnAfterRenderView:function(bL,bM){var bN,bO;bN=this;bO=h.Id();this.Append(_9.BindView(function(bP){bN.elt[bO]=bP;return _9.Empty();},bL));return this.OnAfterRender(function(bP){bM(bP,bP[bO]);});},OnAfterRender:function(bL){var bM,bN;bA.SetOptional(this.get_DocElemNode(),"Render",(bM=bA.GetOptional(this.get_DocElemNode().Render),(bM!=null?bM.$==1:false)?(bN=bM.$0,{$:1,$0:function(bO){bN(bO);bL(bO);}}):{$:1,$0:bL}));return this;},onView:function(bL,bM,bN){var bO;bO=bN(this.elt);this.elt.addEventListener(bL,function(bP){var bQ;bQ=bO(bP);return x.Get(bQ,bM);},false);return this;},on:function(bL,bM){this.elt.addEventListener(bL,function(bN){return bM(bN.target,bN);},false);return this;}},_9,_);_.New=function(bL,bM,bN){var bO,bP,bQ,bR;bO=_8.CreateElemNode(bL,bM,bN.docNode);bP=y.Create$1(bN.updates);bQ=Y.Updates(bO.Attr);bR=x.Bind(function(bS){return x.Map2Unit(bQ,bS);},bP.v);return new _.New$1(new _2({$:1,$0:bO}),bR,bL,bP);};_.New$1=bA.Ctor(function(bL,bM,bN,bO){_9.New.call(this,bL,bM);this.docNode$1=bL;this.elt=bN;this.rvUpdates=bO;null;},_);$.$cctor=bA.Cctor(function(){$.LoadedTemplates=new bJ.New$5();$.TextHoleRE="\\${([^}]+)}";$.$cctor=a.ignore;});ba=d.Flow=bA.Class({get_Render:function(){return this.render;}},null,ba);ba.New=bA.Ctor(function(bL){ba.New$1.call(this,bA.Curried2(function(bM,bN){var bO;bO=bL(bN);return y.Set(bM,bO);}));},ba);ba.New$1=bA.Ctor(function(bL){this.render=bL;null;},ba);ba.get_Do=function(){return new bb.New();};ba.Static=function(bL){return new ba.New$1(bA.Curried2(function(bM,bN){y.Set(bM,bL);return bN();}));};ba.Define=function(bL){return new ba.New(function(bM){return bL(function(bN){bM(bN);});});};ba.Embed=function(bL){var bM;bM=y.Create$1(_9.Empty());((bL.get_Render())(bM))(function(bN){});return _9.EmbedView(bM.v);};ba.Return=function(bL){return new ba.New$1(bA.Curried2(function(bM,bN){return bN(bL);}));};ba.Bind=function(bL,bM){return new ba.New$1(bA.Curried2(function(bN,bO){return((bL.get_Render())(bN))(function(bP){((bM(bP).get_Render())(bN))(bO);});}));};ba.Map=function(bL,bM){return new ba.New$1(bA.Curried2(function(bN,bO){return((bM.get_Render())(bN))(function(bP){bO(bL(bP));});}));};bb=d.FlowBuilder=bA.Class({ReturnFrom:a.id,Return:function(bL){return ba.Return(bL);},Bind:function(bL,bM){return ba.Bind(bL,bM);}},null,bb);bb.New=bA.Ctor(function(){},bb);bd=bc.attr=bA.Class({},null,bd);bd.New=bA.Ctor(function(){},bd);bf=be.T=bA.Class({},null,bf);be.Append=function(bL,bM){return new bf({$:0,$0:o.Append(bL.$0,bM.$0),$1:bD.FoldBack(function(bN,bO,bP){return bP.Add(bN,bO);},bL.$1,bM.$1)});};be.FromList=function(bL,bM){var bN;bN=o.FromArray(bs.ofList(bL));return new bf({$:0,$0:bN,$1:bM});};be.ToList=function(bL){return[br.ofArray(o.ToArray(bL.$0)),bL.$1];};be.SameHash=function(bL,bM){return be.NoHash(bL)===be.NoHash(bM);};be.MakeHash=function(bL){var bM,bN,bO,bP,bQ,bR;bM=bL.$1;bN=(bO=(bP=o.ToArray(bL.$0),bs.map(function(bS){return a.encodeURIComponent(bS);},bP)),bu.concat("/",bO));return bM.get_IsEmpty()?bN:bN+"?"+(bQ=(bR=function(bS){var bT;bT=bG.KeyValue(bS);return a.encodeURIComponent(bT[0])+"="+a.encodeURIComponent(bT[1]);},function(bS){return by.map(bR,bS);}(bM)),bu.concat("&",bQ));};be.ParseHash=function(bL){var bM,bN,bO,bP,bQ,bR,bS,bT;bM=be.NoHash(bL);bN=(bO=bM.indexOf(a.String.fromCharCode(63)),bO===-1?[bM,""]:[bK.string(bM,null,{$:1,$0:bO-1}),bK.string(bM,{$:1,$0:bO+1},null)]);bP=bN[0];bQ=o.FromArray(bP===""?[]:(bR=bu.SplitChars(bP,[47],0),bs.map(function(bU){return a.decodeURIComponent(bU);},bR)));bS=bD.OfArray((bT=function(bU){var bV,bW,bX;bV=bU.indexOf(a.String.fromCharCode(61));return bV===-1?[a.decodeURIComponent(bU),""]:[(bW=bK.string(bU,null,{$:1,$0:bV-1}),a.decodeURIComponent(bW)),(bX=bK.string(bU,{$:1,$0:bV+1},null),a.decodeURIComponent(bX))];},function(bU){return bs.map(bT,bU);}(bu.SplitChars(bN[1],[38],0))));return new bf({$:0,$0:bQ,$1:bS});};be.NoHash=function(bL){return bu.StartsWith(bL,"#")?bL.substring(1):bL;};bh=bg.State=bA.Class({},null,bh);bh.New=function(bL,bM,bN,bO){return new bh({Bodies:bL,CurrentRoute:bM,CurrentSite:bN,Selection:bO});};bg.Install=function(bL,bM){var bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW;function bX(bY){var bZ,b0;bZ=bS(bY);bZ.$==1?null:(b0=be.FromList(bZ.$1,new bE.New([])),bg.OnGlobalRouteChange(bP,bZ.$0,b0));}bN=bM.$0;bO=bg.InstallMap({Des:function(bY){return be.FromList(bY[0],bY[1]);},Ser:be.ToList});bP=bh.New(void 0,bO,0,void 0);bQ=(bR=function(bY,bZ){var b0;b0=bZ.$0;return bZ.$1({UpdateRoute:function(b1){bg.OnInternalSiteUpdate(bP,b0,bY,b1);}});},function(bY){return t.Map(bA.Curried2(bR),bY);}(bM.$1));bP.Bodies=bg.ComputeBodies(bQ);bS=function(bY){var bZ;bZ=be.ToList(bY);return t.Lookup(bQ,bZ[0]);};bT=(bU=bS(bO.c),bU.$==0?(bV=bU.$0,(bP.CurrentSite=bV.RouteId,y.Create$1(bV.RouteValue))):y.Create$1((bN!=null?bN.$==1:false)?bN.$0:bG.FailWith("Site.Install fails on empty site")));bP.Selection=bT;bW=function(bY){bg.OnSelectSite(bP,bL(bY));};(function(bY){x.Sink(bW,bY);}(bT.v));bX(bO.c);x.Sink(bX,bO.v);return bT;};bg.OnSelectSite=function(bL,bM){var bN;bN=bM.$0;bL.CurrentSite!==bN?(bL.CurrentSite=bN,bL.Bodies.get_Item(bN).OnSelect()):null;};bg.OnInternalSiteUpdate=function(bL,bM,bN,bO){var bP;if(bL.CurrentSite===bM){bP=be.Append(be.FromList(bN,new bE.New([])),bO);bg.SetCurrentRoute(bL,bP);}};bg.OnGlobalRouteChange=function(bL,bM,bN){bL.CurrentSite!==bM.RouteId?(bL.CurrentSite=bM.RouteId,y.Set(bL.Selection,bM.RouteValue)):null;bM.OnRouteChanged(bN);};bg.SetCurrentRoute=function(bL,bM){if(!bB.Equals(bL.CurrentRoute.c,bM))y.Set(bL.CurrentRoute,bM);};bg.ComputeBodies=function(bL){var bM,bN;bM=new bJ.New$5();bN=function(bO){bM.set_Item(bO.RouteId,bO);};(function(bO){bs.iter(bN,bO);}(t.ToArray(bL)));return bM;};bg.MergeRouters=function(bL){var bM,bN,bO,bP,bQ;bM=e.ofSeqNonCopying(bL);bN=t.Merge((bO=function(bR){return bR.$1;},function(bR){return by.map(bO,bR);}(bM)));bP=(bQ=function(bR){return bR.$0;},function(bR){return by.tryPick(bQ,bR);}(bM));return(bN!=null?bN.$==1:false)?{$:0,$0:bP,$1:bN.$0}:bG.FailWith("Invalid Site.Merge: need more prefix disambiguation");};bg.DefineRoute=function(bL,bM,bN){var bO,bP,bQ;bO=y.Create$1(bM);bP=h.Int();bQ=bN({$:0,$0:bP},bO);return{$:0,$0:{$:1,$0:bQ},$1:t.Leaf({$:0,$0:bP,$1:function(bR){var bS;bS=function(bT){bR.UpdateRoute(bg.DoLink(bL,bT));};(function(bT){x.Sink(bS,bT);}(bO.v));return{OnRouteChanged:function(bT){var bU;bU=bg.DoRoute(bL,bT);y.Set(bO,bU);},OnSelect:function(){bR.UpdateRoute(bg.DoLink(bL,bO.c));},RouteId:bP,RouteValue:bQ};}})};};bg.DoLink=function(bL,bM){var bN;bN=bL.Ser(bM);return be.FromList(bN[0],bN[1]);};bg.DoRoute=function(bL,bM){return bL.Des(be.ToList(bM));};bg.InstallMap=function(bL){var bM,bN,bO,bP,bQ,bR;function bS(bT){return bQ(bO());}bM=a.window;bN=function(bT,bU){return bB.Equals(bL.Ser(bT),bL.Ser(bU));};bO=function(){return bL.Des(be.ToList(be.ParseHash(bM.location.hash)));};bP=y.Create$1(bO());bQ=function(bT){if(!bN(bP.c,bT))y.Set(bP,bT);};bM.onpopstate=bS;bM.onhashchange=bS;bR=function(bT){var bU,bV;bU=be.MakeHash((bV=bL.Ser(bT),be.FromList(bV[0],bV[1])));!be.SameHash(bM.location.hash,bU)?bM.location.replace("#"+bU):null;};(function(bT){x.Sink(bR,bT);}(bP.v));return bP;};bi.Install=function(bL){return bg.InstallMap(bL);};bi.Create=function(bL,bM){var bN;return{Des:(bN=function(bO){return bO[0];},function(bO){return bM(bN(bO));}),Ser:function(bO){return[bL(bO),new bE.New([])];}};};bi.CreateWithQuery=function(bL,bM){return{Des:bM,Ser:bL};};bj.Route=function(bL,bM,bN){return bg.DefineRoute(bL,bM,bN);};bj.Prefix=function(bL,bM){return{$:0,$0:bM.$0,$1:t.Prefix(bL,bM.$1)};};bj.Merge=function(bL){return bg.MergeRouters(bL);};bj.Install=function(bL,bM){return bg.Install(bL,bM);};bj.Dir=function(bL,bM){var bN;bN=bj.Merge(bM);return bj.Prefix(bL,bN);};bl=bk.MousePosSt=bA.Class({},null,bl);bl.New=function(bL,bM){return new bl({Active:bL,PosV:bM});};bm=bk.MouseBtnSt=bA.Class({},null,bm);bm.New=function(bL,bM,bN,bO){return new bm({Active:bL,Left:bM,Middle:bN,Right:bO});};bn.get_MousePressed=function(){var bL,bM,bN,bO,bP,bQ;bk.ActivateButtonListener();bL=(bM=(bN=x.Const(bA.Curried3(function(bR,bS,bT){return(bR?true:bS)?true:bT;})),(bO=bk.MouseBtnSt$1().Left.v,x.Apply(bN,bO))),(bP=bk.MouseBtnSt$1().Middle.v,x.Apply(bM,bP)));bQ=bk.MouseBtnSt$1().Right.v;return x.Apply(bL,bQ);};bn.get_RightPressed=function(){bk.ActivateButtonListener();return bk.MouseBtnSt$1().Right.v;};bn.get_MiddlePressed=function(){bk.ActivateButtonListener();return bk.MouseBtnSt$1().Middle.v;};bn.get_LeftPressed=function(){bk.ActivateButtonListener();return bk.MouseBtnSt$1().Left.v;};bn.get_Position=function(){!bk.MousePosSt$1().Active?(a.document.addEventListener("mousemove",function(bL){var bM,bN;bM=bk.MousePosSt$1().PosV;bN=[bL.clientX,bL.clientY];y.Set(bM,bN);},false),bk.MousePosSt$1().Active=true):null;return bk.MousePosSt$1().PosV.v;};bo=bk.KeyListenerSt=bA.Class({},null,bo);bo.New=function(bL,bM,bN){return new bo({KeysPressed:bL,KeyListenerActive:bM,LastPressed:bN});};bp.IsPressed=function(bL){var bM,bN;bk.ActivateKeyListener();bM=bk.KeyListenerState().KeysPressed.v;return x.Map((bN=function(bO){return bO===bL;},function(bO){return br.exists(bN,bO);}),bM);};bp.get_LastPressed=function(){bk.ActivateKeyListener();return bk.KeyListenerState().LastPressed.v;};bp.get_KeysPressed=function(){bk.ActivateKeyListener();return bk.KeyListenerState().KeysPressed.v;};bk.ActivateKeyListener=function(){bq.$cctor();return bq.ActivateKeyListener;};bk.KeyListenerState=function(){bq.$cctor();return bq.KeyListenerState;};bk.ActivateButtonListener=function(){bq.$cctor();return bq.ActivateButtonListener;};bk.MouseBtnSt$1=function(){bq.$cctor();return bq.MouseBtnSt;};bk.MousePosSt$1=function(){bq.$cctor();return bq.MousePosSt;};bq.$cctor=bA.Cctor(function(){var bL,bM,bN,bO,bP,bQ,bR,bS,bT;bq.MousePosSt=bl.New(false,y.Create$1([0,0]));bq.MouseBtnSt=bm.New(false,y.Create$1(false),y.Create$1(false),y.Create$1(false));bq.ActivateButtonListener=(bL=function(bU,bV){var bW,bX,bY,bZ;bW=bU.button;return bW===0?(bX=bk.MouseBtnSt$1().Left,y.Set(bX,bV)):bW===1?(bY=bk.MouseBtnSt$1().Middle,y.Set(bY,bV)):bW===2?(bZ=bk.MouseBtnSt$1().Right,y.Set(bZ,bV)):null;},!bk.MouseBtnSt$1().Active?(bk.MouseBtnSt$1().Active=true,a.document.addEventListener("mousedown",function(bU){return bL(bU,true);},false),a.document.addEventListener("mouseup",function(bU){return bL(bU,false);},false)):null);bq.KeyListenerState=bo.New(y.Create$1(new br.T({$:0})),false,y.Create$1(-1));bq.ActivateKeyListener=!bk.KeyListenerState().KeyListenerActive?(bM=(bN=(bO=a.document,a.jQuery(bO)),(bP=function(bU,bV){var bW,bX,bY,bZ,b0;bW=bV.which;bX=bk.KeyListenerState().LastPressed;y.Set(bX,bW);bY=bk.KeyListenerState().KeysPressed.c;return!br.exists(function(b1){return b1===bW;},bY)?(bZ=bk.KeyListenerState().KeysPressed,(b0=br.append(bY,br.ofArray([bW])),y.Set(bZ,b0))):null;},bN.keydown(function(bU){return bP(this,bU);}))),void 0,(bQ=(bR=(bS=a.document,a.jQuery(bS)),(bT=function(bU,bV){var bW,bX,bY;bW=bV.which;bX=bk.KeyListenerState().KeysPressed;return y.Update(bX,(bY=function(bZ){return bZ!==bW;},function(bZ){return br.filter(bY,bZ);}));},bR.keyup(function(bU){return bT(this,bU);}))),void 0)):null;bq.$cctor=a.ignore;});}());
